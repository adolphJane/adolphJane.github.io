<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  FFmpeg - MagicalRice的Blog
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="MagicalRice的Blog" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
 
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:adolph.cc ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="_self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="https://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; MagicalRice的Blog</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        
        <li><a target="_self" href="index.html">Home</a></li>
        
        <li><a target="_self" href="archives.html">Archives</a></li>
        

    <li><label>Categories</label></li>

        
            <li><a href="Android.html">Android</a></li>
        
            <li><a href="%E6%9C%8D%E5%8A%A1%E5%99%A8.html">服务器</a></li>
        
            <li><a href="C++.html">C++</a></li>
        
            <li><a href="UI.html">UI</a></li>
        
            <li><a href="%E4%BB%A3%E7%A0%81%E4%B9%8B%E7%BE%8E.html">代码之美</a></li>
        
            <li><a href="Game.html">Game</a></li>
        
            <li><a href="Python.html">Python</a></li>
        
            <li><a href="Mac.html">Mac</a></li>
        
            <li><a href="%E5%85%B6%E4%BB%96.html">其他</a></li>
        
            <li><a href="Flutter.html">Flutter</a></li>
        
            <li><a href="ReactNative.html">ReactNative</a></li>
        
            <li><a href="Java.html">Java</a></li>
        
            <li><a href="%E9%9F%B3%E8%A7%86%E9%A2%91%E5%BC%80%E5%8F%91.html">音视频开发</a></li>
        
            <li><a href="%E7%BD%91%E7%BB%9C.html">网络</a></li>
        
            <li><a href="%E7%BD%91%E9%A1%B5.html">网页</a></li>
        
            <li><a href="%E5%B7%A5%E5%85%B7-1-2.html">工具</a></li>
        
            <li><a href="%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD.html">人工智能</a></li>
        
            <li><a href="%E5%88%9B%E4%B8%9A.html">创业</a></li>
        
            <li><a href="%E6%80%9D%E7%BB%B4%E6%8F%90%E5%8D%87.html">思维提升</a></li>
        
            <li><a href="GPU%E6%B8%B2%E6%9F%93.html">GPU渲染</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
  $(function(){
    $('#menu_item_index').addClass('is_active');
  });
</script>
<div class="row">
  <div class="large-8 medium-8 columns">
      <div class="markdown-body article-wrap">
       <div class="article">
          
          <h1>FFmpeg</h1>
     
        <div class="read-more clearfix">
          <span class="date">2022/05/20</span>

          <span>posted in&nbsp;</span> 
          
              <span class="posted-in"><a href='%E9%9F%B3%E8%A7%86%E9%A2%91%E5%BC%80%E5%8F%91.html'>音视频开发</a></span>
           
         
          <span class="comments">
            

            
          </span>

        </div>
      </div><!-- article -->

      <div class="article-content">
      <span id="more"></span><!-- more -->
<div class="mweb_toc"><ul>
<li><a href="#%E4%B8%93%E4%B8%9A%E6%9C%AF%E8%AF%AD">专业术语</a></li>
<li><a href="#%E4%B8%BB%E8%A6%81%E6%A8%A1%E5%9D%97">主要模块</a>
<ul>
<li><a href="#libavutil">libavutil</a></li>
<li><a href="#libswscale">libswscale</a></li>
<li><a href="#libswresample">libswresample</a></li>
<li><a href="#libavcodec">libavcodec</a></li>
<li><a href="#libavformat">libavformat</a></li>
<li><a href="#libavdevice">libavdevice</a></li>
<li><a href="#libavfilter">libavfilter</a></li>
<li><a href="#libpostproc">libpostproc</a></li>
</ul>
</li>
<li><a href="#ffmpeg%E5%91%BD%E4%BB%A4%E8%A1%8C">FFmpeg命令行</a>
<ul>
<li><a href="#ffmpeg%E7%9A%84%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2%E9%83%A8%E5%88%86">FFmpeg的信息查询部分</a></li>
<li><a href="#%E5%85%AC%E5%85%B1%E6%93%8D%E4%BD%9C%E5%8F%82%E6%95%B0%E9%83%A8%E5%88%86">公共操作参数部分</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E4%B8%BB%E8%A6%81%E6%93%8D%E4%BD%9C%E5%8F%82%E6%95%B0%E9%83%A8%E5%88%86">文件主要操作参数部分</a></li>
<li><a href="#%E8%A7%86%E9%A2%91%E6%93%8D%E4%BD%9C%E5%8F%82%E6%95%B0%E9%83%A8%E5%88%86">视频操作参数部分</a>
<ul>
<li><a href="#%E8%A7%86%E9%A2%91%E5%89%AA%E5%88%87">视频剪切</a></li>
<li><a href="#%E8%A7%86%E9%A2%91%E8%BD%AC%E7%A0%81">视频转码</a></li>
<li><a href="#%E8%A7%86%E9%A2%91%E6%88%AA%E5%9B%BE">视频截图</a></li>
<li><a href="#%E5%9B%BE%E7%89%87%E6%B0%B4%E5%8D%B0">图片水印</a></li>
<li><a href="#gif%E6%B0%B4%E5%8D%B0">GIF水印</a></li>
<li><a href="#%E5%8E%BB%E9%99%A4%E6%B0%B4%E5%8D%B0">去除水印</a></li>
<li><a href="#%E8%A7%86%E9%A2%91%E6%8B%BC%E6%8E%A5">视频拼接</a></li>
<li><a href="#%E8%A7%86%E9%A2%91%E7%BF%BB%E8%BD%AC">视频翻转</a></li>
<li><a href="#%E8%A7%86%E9%A2%91%E9%99%8D%E5%99%AA">视频降噪</a></li>
<li><a href="#%E8%A7%86%E9%A2%91%E6%8A%BD%E5%B8%A7">视频抽帧</a></li>
<li><a href="#%E6%92%AD%E6%94%BE%E9%80%9F%E5%BA%A6">播放速度</a></li>
<li><a href="#%E9%BB%91%E7%99%BD%E8%A7%86%E9%A2%91">黑白视频</a></li>
</ul>
</li>
<li><a href="#%E9%9F%B3%E9%A2%91%E6%93%8D%E4%BD%9C%E5%8F%82%E6%95%B0%E9%83%A8%E5%88%86">音频操作参数部分</a>
<ul>
<li><a href="#%E9%9F%B3%E9%A2%91%E8%BD%AC%E7%A0%81">音频转码</a></li>
<li><a href="#%E9%9F%B3%E9%A2%91%E5%89%AA%E5%88%87">音频剪切</a></li>
<li><a href="#%E9%9F%B3%E9%A2%91%E6%8B%BC%E6%8E%A5">音频拼接</a></li>
<li><a href="#%E9%9F%B3%E9%A2%91%E6%B7%B7%E9%9F%B3">音频混音</a></li>
<li><a href="#%E7%A9%BA%E7%81%B5%E9%9F%B3%E6%95%88">空灵音效</a></li>
<li><a href="#%E6%83%8A%E6%82%9A%E9%9F%B3%E6%95%88">惊悚音效</a></li>
<li><a href="#%E6%90%9E%E7%AC%91%E9%9F%B3%E6%95%88">搞笑音效</a></li>
<li><a href="#%E9%9D%99%E9%9F%B3%E6%A3%80%E6%B5%8B">静音检测</a></li>
<li><a href="#%E4%BF%AE%E6%94%B9%E9%9F%B3%E9%87%8F">修改音量</a></li>
<li><a href="#%E6%8A%BD%E5%8F%96%E9%9F%B3%E9%A2%91">抽取音频</a></li>
</ul>
</li>
<li><a href="#%E5%AD%97%E5%B9%95%E6%93%8D%E4%BD%9C%E5%8F%82%E6%95%B0%E9%83%A8%E5%88%86">字幕操作参数部分</a></li>
</ul>
</li>
<li><a href="#ffmpeg%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%AD%97%E7%AC%A6%E5%91%BD%E4%BB%A4">FFmpeg的基本字符命令</a></li>
<li><a href="#filter%E6%BB%A4%E9%95%9C">Filter(滤镜)</a>
<ul>
<li><a href="#%E5%A4%8D%E6%9D%82%E8%BF%87%E6%BB%A4%E5%99%A8filter-complex">复杂过滤器(filter_complex)</a></li>
<li><a href="#scale">scale</a></li>
<li><a href="#overlay">overlay</a></li>
<li><a href="#delogo">delogo</a></li>
<li><a href="#crop">crop</a></li>
<li><a href="#setpts">setpts</a></li>
<li><a href="#map">-map</a></li>
</ul>
</li>
<li><a href="#%E6%B0%B4%E5%B9%B3%E7%BF%BB%E8%BD%AChflip">水平翻转hflip</a>
<ul>
<li><a href="#%E9%95%9C%E5%83%8F">镜像</a></li>
<li><a href="#%E5%90%84%E7%A7%8D%E7%89%B9%E6%95%88curves">各种特效curves</a></li>
<li><a href="#%E8%BE%B9%E7%BC%98%E6%A3%80%E6%B5%8Bedgedetect">边缘检测edgedetect</a></li>
<li><a href="#%E5%85%89%E6%99%95vignette-pi4">光晕vignette=PI/4</a></li>
<li><a href="#%E5%8F%98%E6%9A%97">变暗</a></li>
<li><a href="#%E5%A2%9E%E5%8A%A0%E5%AF%B9%E6%AF%94%E5%BA%A6">增加对比度</a></li>
<li><a href="#%E9%99%8D%E5%99%AA">降噪</a></li>
<li><a href="#%E9%94%90%E5%8C%96">锐化</a></li>
<li><a href="#%E4%BD%8E%E9%80%9A%E6%BB%A4%E6%B3%A2">低通滤波</a></li>
<li><a href="#%E9%AB%98%E9%80%9A%E6%BB%A4%E6%B3%A2">高通滤波</a></li>
<li><a href="#fade%E8%A7%86%E9%A2%91%E6%B7%A1%E5%85%A5%E6%B7%A1%E5%87%BA%E6%95%88%E6%9E%9C">fade 视频淡入淡出效果</a></li>
</ul>
</li>
<li><a href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">常用命令</a>
<ul>
<li><a href="#%E5%89%AA%E5%88%87%E5%A4%9A%E4%B8%AA%E6%96%87%E4%BB%B6">剪切多个文件</a></li>
<li><a href="#%E8%A7%86%E9%A2%91%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2">视频格式转换</a></li>
<li><a href="#%E8%A7%86%E9%A2%91%E8%BD%ACgif">视频转Gif</a></li>
<li><a href="#%E8%A7%86%E9%A2%91%E8%BD%AC%E5%A4%9A%E5%BC%A0%E5%9B%BE%E7%89%87">视频转多张图片</a></li>
<li><a href="#gif%E8%BD%AC%E8%A7%86%E9%A2%91">Gif转视频</a></li>
<li><a href="#%E5%A4%9A%E4%B8%AA%E8%A7%86%E9%A2%91%E5%90%88%E5%B9%B6">多个视频合并</a></li>
<li><a href="#%E4%BF%AE%E6%94%B9%E8%A7%86%E9%A2%91%E5%88%86%E8%BE%A8%E7%8E%87">修改视频分辨率</a></li>
<li><a href="#%E7%BB%99%E8%A7%86%E9%A2%91%E6%B7%BB%E5%8A%A0%E9%9F%B3%E9%A2%91">给视频添加音频</a></li>
<li><a href="#%E6%8F%90%E5%8F%96%E8%A7%86%E9%A2%91%E4%B8%AD%E7%9A%84%E9%9F%B3%E9%A2%91">提取视频中的音频</a></li>
<li><a href="#%E8%A7%86%E9%A2%91%E9%9D%99%E9%9F%B3">视频静音</a></li>
<li><a href="#%E9%9F%B3%E9%A2%91%E5%90%88%E5%B9%B6">音频合并</a></li>
</ul>
</li>
<li><a href="#%E9%AB%98%E7%BA%A7%E5%91%BD%E4%BB%A4">高级命令</a>
<ul>
<li><a href="#%E9%9F%B3%E9%A2%91%E6%B7%B7%E9%9F%B3">音频混音</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E6%96%87%E5%AD%97%E6%B0%B4%E5%8D%B0">添加文字水印</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E5%9B%BE%E7%89%87%E6%B0%B4%E5%8D%B0">添加图片水印</a></li>
<li><a href="#%E8%B7%91%E9%A9%AC%E7%81%AF%E6%95%88%E6%9E%9C">跑马灯效果</a></li>
<li><a href="#%E8%A7%86%E9%A2%91%E5%8E%BB%E6%B0%B4%E5%8D%B0">视频去水印</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E5%8A%A8%E7%94%BB">添加动画</a></li>
<li><a href="#%E6%B7%A1%E5%85%A5%E6%B7%A1%E5%87%BA%E6%95%88%E6%9E%9C%E5%99%A8">淡入淡出效果器</a></li>
<li><a href="#%E8%A7%86%E9%A2%91%E6%8F%90%E4%BA%AE%E6%95%88%E6%9E%9C%E5%99%A8">视频提亮效果器</a></li>
<li><a href="#%E4%B8%BA%E8%A7%86%E9%A2%91%E5%A2%9E%E5%8A%A0%E5%AF%B9%E6%AF%94%E5%BA%A6%E6%95%88%E6%9E%9C">为视频增加对比度效果</a></li>
<li><a href="#%E6%88%AA%E5%8F%96%E8%A7%86%E9%A2%91%E5%8C%BA%E5%9F%9F">截取视频区域</a></li>
<li><a href="#%E6%97%8B%E8%BD%AC%E8%A7%86%E9%A2%91">旋转视频</a></li>
<li><a href="#%E6%94%B9%E5%8F%98%E8%A7%86%E9%A2%91%E9%9F%B3%E9%87%8F">改变视频音量</a></li>
<li><a href="#%E5%8E%8B%E7%BC%A9%E8%A7%86%E9%A2%91">压缩视频</a></li>
<li><a href="#%E6%8E%A8%E8%8D%90%E6%AF%94%E7%89%B9%E7%8E%87">推荐比特率</a></li>
</ul>
</li>
<li><a href="#ffplay%E5%91%BD%E4%BB%A4%E8%A1%8C">ffplay命令行</a>
<ul>
<li><a href="#%E6%92%AD%E6%94%BEpcm%E9%9F%B3%E9%A2%91">播放pcm音频</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E7%94%9F%E6%88%90%E8%A7%86%E9%A2%91%E5%B8%A7">通过原始数据生成视频帧</a></li>
</ul>
</li>
<li><a href="#ffprobe%E5%91%BD%E4%BB%A4%E8%A1%8C">ffprobe命令行</a></li>
</ul>
</div>
<p>FFmpeg是一套可以用来记录、转换数字音频、视频，并能将其转化为流的开源计算机程序。它提供了录制、转换以及流化音视频的完整解决方案。</p>
<h2><a id="%E4%B8%93%E4%B8%9A%E6%9C%AF%E8%AF%AD" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>专业术语</h2>
<ul>
<li><strong>容器/文件（Conainer/File）</strong>：即特定格式的多媒体文件，比如MP4、flv、mov等。</li>
<li><strong>媒体流（Stream）</strong>：表示时间轴上的一段连续数据，如一段声音数据、一段视频数据或一段字幕数据，可以是压缩的，也可以是非压缩的，压缩的数据需要关联特定的编解码器。</li>
<li><strong>数据帧/数据包（Frame/Packet）</strong>：通常，一个媒体流是由大量的数据帧组成的，对于压缩数据，帧对应着编解码器的最小处理单元，分属于不同媒体流的数据帧交错存储于容器之中。</li>
<li><strong>编解码器</strong>：编解码器是以帧为单位实现压缩数据和原始数据之间的相互转换的。</li>
</ul>
<h2><a id="%E4%B8%BB%E8%A6%81%E6%A8%A1%E5%9D%97" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>主要模块</h2>
<p>FFmpeg主要包含以下几个模块：</p>
<ul>
<li><strong>libavcodec</strong> 该模块主要负责解码与编码 <em>【核心模块】</em></li>
<li><strong>libavformat</strong> 该模块主要负责解封装与封装 <em>【核心模块】</em></li>
<li><strong>libavutil</strong> 提供工具类</li>
<li><strong>libavdevice</strong> 该模块主要负责与各个平台的硬件设备的交互</li>
<li><strong>libavfilter</strong> 该模块主要负责音视频的过滤，包括裁剪、位置、水印等</li>
<li><strong>libswscale</strong> 该模块主要负责对原始视频数据进行场景转换、图像缩放、色彩映射以及像素格式转换</li>
<li><strong>libswresample</strong> 该模块主要负责对原始音频数据进行格式转换</li>
<li><strong>libavresample</strong> 该模块主要负责音视频封装编解码格式预设,默认不编译</li>
<li><strong>libpostproc</strong> 该模块主要负责对音视频进行后期处理，提供高级处理</li>
</ul>
<h3><a id="libavutil" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>libavutil</h3>
<p>libavutil是一个实用库，用于辅助多媒体编程。此库包含<strong>安全的可移植字符串函数</strong>、<strong>随机数生成器</strong>、<strong>数据结构</strong>、<strong>附加数学函数</strong>、<strong>加密和多媒体相关功能</strong>(如像素和样本格式的枚举)。libavcodec和libavformat并不依赖此库。</p>
<h3><a id="libswscale" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>libswscale</h3>
<p>libswscale库用于执行高度优化的图像缩放、颜色空间和像素格式转换的操作。比如，可以将YUV的数据转换为RGB的数据。具体而言，此库执行以下转换：</p>
<ul>
<li>重缩放：一种更改视频大小的操作。有几种重缩放选项和算法可用。这通常是一个有损的操作。</li>
<li>像素格式转换：是将图像格式和色域转换为图像的操作，例如从平面YUV420P转换为RGB24压缩。它还处理打包转换，即从打包布局（属于在同一缓冲区中交错的不同平面的所有像素）转换为平面布局（属于存储在专用缓冲区或“平面”中的同一平面的所有样本）。</li>
</ul>
<p>如果源和目标色域不同，这通常是一个有损过程。</p>
<h3><a id="libswresample" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>libswresample</h3>
<p>libswresample库用于执行高度优化的音频重采样、重矩阵化和采样格式转换操作。具体而言，此库执行以下转换：</p>
<ul>
<li><strong>重采样</strong>：是更改音频速率的操作，例如从44100Hz的高采样率更改为8000Hz。从高采样率到低采样率的音频转换是一个有损过程。有几种重采样选项和算法可用。</li>
<li><strong>格式转换</strong>：是将样本类型转换的操作，例如从16位有符号样本转换为无符号8位或浮点样本。当从打包布局（属于在同一缓冲区中交错的不同通道的所有样本）传递到平面布局（属于存储在专用缓冲区或“平面”中的同一通道的所有样本）时，它还处理打包转换。</li>
<li><strong>重新调制</strong>：是改变频道布局（Channel Layout）的操作，例如从立体声到单声道。当输入通道无法映射到输出流时，该过程是有损的，因为它涉及不同的增益因子和混合.</li>
</ul>
<h3><a id="libavcodec" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>libavcodec</h3>
<p>libavcodec库提供通用编码/解码框架，包含用于音频、视频和字幕流的多个解码器和编码器，以及多个位流过滤器。封装了Codec层，但是有一些Codec是具备自己的License的，FFmpeg是不会默认添加像libx264、FDK-AAC、lame等库的，但是FFmpeg就像一个平台一样，可以将其他的第三方的Codec以插件的方式添加进来，然后为开发者提供统一的接口。</p>
<h3><a id="libavformat" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>libavformat</h3>
<p>libavformat库为多路复用和解复用音频、视频和字幕流提供了通用框架。它包含用于多媒体容器格式的多个多路复用器和解复用器。封装了Protocol层和Demuxer、Muxer层，使得协议和格式对于开发者来说是透明的。</p>
<p>它还支持多种输入和输出协议来访问媒体资源。</p>
<blockquote>
<p><strong>多路复用</strong>: 数据通信系统或计算机网络系统中，传输媒体的带宽或容量往往会大于传输单一信号的需求，为了有效地利用通信线路,希望一个信道同时传输多路信号，这就是所谓的多路复用技术(Multiplexing)。采用多路复用技术能把多个信号组合起来在一条物理信道上进行传输，在远距离传输时可大大节省电缆的安装和维护费用。</p>
</blockquote>
<h3><a id="libavdevice" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>libavdevice</h3>
<p>libavdevice库提供了一个通用框架，用于从许多常见的多媒体输入/输出设备进行抓取和渲染，并支持多种输入和输出设备，包括Video4Linux2、VfW、DShow和ALSA。比如，需要编译出播放声音或者视频的工具ffplay，就需要确保该模块是打开的，同时也需要libSDL的预先编译，因为该设备模块播放声音与播放视频使用的都是libSDL库。</p>
<h3><a id="libavfilter" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>libavfilter</h3>
<p>libavfilter库是一个通用的音频/视频的滤镜框架，其中包含多个滤镜、源（sources）和汇聚点(sinks)。该模块提供了包括音频特效和视频特效的处理，在使用FFmpeg的API进行编解码的过程中，直接使用该模块为音视频数据做特效处理是非常方便同时也非常高效的一种方式。</p>
<blockquote>
<p><strong>源（sources）和汇聚点(sinks)</strong>: libavfilter可以存在多个滤镜组合处理音视频，每个滤镜都具有input及output端口。一个滤镜的output可以和另一个滤镜的input 连接起来,其中第一个滤镜称为源（source），它只有output端口，最后一个滤镜称为汇聚点(sink)，它只有input端口。</p>
</blockquote>
<h3><a id="libpostproc" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>libpostproc</h3>
<p>该模块可用于进行后期处理，当我们使用AVFilter的时候需要打开该模块的开关，因为Filter中会使用到该模块的一些基础函数。</p>
<h2><a id="ffmpeg%E5%91%BD%E4%BB%A4%E8%A1%8C" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>FFmpeg命令行</h2>
<p>在编译成功之后我们可以在<code>install</code>目录下看到一个名为<code>ffmpeg</code>的可执行文件，我们将利用这个文件来学习FFmpeg的命令行。</p>
<p>cd到<code>install</code>目录，执行指令<code>./ffmpeg -h</code>,可以查阅FFmpeg的常用命令。</p>
<p>FFmpeg的命令行结构如下所示：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg [global_op                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   tions] {[input_file_options] -i input_url} ... {[output_file_options] output_url} ...
</code></pre>
<p>FFmpeg的常用命令大致分为6个部分，具体如下：</p>
<ul>
<li>FFmpeg的信息查询部分</li>
<li>公共操作参数部分</li>
<li>文件主要操作参数部分</li>
<li>视频操作参数部分</li>
<li>音频操作参数部分</li>
<li>字幕操作参数部分</li>
</ul>
<h3><a id="ffmpeg%E7%9A%84%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2%E9%83%A8%E5%88%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>FFmpeg的信息查询部分</h3>
<p>FFmpeg的信息查询部分的常用命令如下所示：</p>
<pre class="line-numbers"><code class="language-plain_text">-formats            show available formats
-muxers             show available muxers 【显示所有支持的封装】
-demuxers           show available demuxers 【显示所有可用的解复用器】
-devices            show available devices
-codecs             show available codecs
-decoders           show available decoders 【显示所有可用的解码器】
-encoders           show available encoders 【显示所有可用的编码器】
-bsfs               show available bit stream filters
-protocols          show available protocols
-filters            show available filters
-pix_fmts           show available pixel formats
-layouts            show standard channel layouts
-sample_fmts        show available audio sample formats
-dispositions       show available stream dispositions
-colors             show available color names
-sources device     list sources of the input device
-sinks device       list sinks of the output device
-hwaccels           show available HW acceleration methods
</code></pre>
<p>可以通过<code>-decoders</code>查看FFmpeg支持的解码器、通过<code>-encorders</code>查看FFmpeg支持的编码器，通过<code>-protocals</code>查看FFmpeg支持的协议。上述命令行都比较简单，建议各位读者自行尝试一下，在此不再赘述。</p>
<h3><a id="%E5%85%AC%E5%85%B1%E6%93%8D%E4%BD%9C%E5%8F%82%E6%95%B0%E9%83%A8%E5%88%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>公共操作参数部分</h3>
<p>FFmpeg的公共操作参数部分的常用命令如下所示：</p>
<pre class="line-numbers"><code class="language-plain_text">-loglevel loglevel              set logging level
-v loglevel                     set logging level
-report                         generate a report
-max_alloc bytes                set maximum size of a single allocated block
-y                              overwrite output files
-n                              never overwrite output files
-ignore_unknown                 Ignore unknown stream types
-filter_threads                 number of non-complex filter threads
-filter_complex_threads         number of threads for -filter_complex
-stats                          print progress report during encoding
-max_error_rate maximum error   rate  ratio of decoding errors (0.0: no errors, 1.0: 100% errors) above which ffmpeg      returns an error instead of success.
-bits_per_raw_sample number     set the number of bits per raw sample
-vol volume                     change audio volume (256=normal)
</code></pre>
<blockquote>
<p><code>-loglevel [flags+]loglevel | -v [flags+]loglevel</code>。</p>
</blockquote>
<ul>
<li>falgs 设置库使用的日志记录级别和标志。
<ul>
<li>repeat 指示不应将重复日志输出压缩到第一行，并将省略“最后一条消息重复n次”行。</li>
<li>level 指示日志输出应为每条消息行添加“[level]”前缀。这可以作为日志着色的替代方法，例如在将日志转储到文件时。</li>
</ul>
</li>
</ul>
<p>也可以通过添加“+”/“-”前缀来单独使用标志，以设置/重置单个标志，而不影响其他“标志”或更改“日志级别”。当同时设置'flags'和'loglevel'时，在最后一个'flags'值和'loglevel'之前应该有一个'+'分隔符.</p>
<ul>
<li>loglevel 取值为数字或字符串
<ul>
<li>quiet, -8 不输出任何日志。</li>
<li>panic, 0 仅显示可能导致进程崩溃的致命错误，例如断言失败。目前代码里还没有使用这个级别的log。</li>
<li>fatal, 8 仅显示致命错误。发生这些错误之后，程序绝对无法继续执行。</li>
<li>error, 16 显示所有错误，包括可以从中恢复的错误。</li>
<li>warning, 24 显示所有警告和错误。将显示与可能不正确或意外事件相关的任何消息。</li>
<li>info, 32 在处理过程中显示信息性消息。此为默认值。</li>
<li>verbose, 40 与info相同，只是更详细一些。</li>
<li>debug, 48 显示所有内容，包括调试信息。</li>
</ul>
</li>
</ul>
<p>例如，要启用重复日志输出，请添加级别前缀，并将loglevel设置为verbose：</p>
<pre class="line-numbers"><code class="language-plain_text">./ffmpeg -loglevel repeat+level+verbose -i input output
</code></pre>
<p>另一个示例，在不影响级别前缀标志或loglevel的当前状态的情况下启用重复日志输出:</p>
<pre class="line-numbers"><code class="language-plain_text">./ffmpeg [...] -loglevel +repeat
</code></pre>
<blockquote>
<p><code>-y</code> 无需询问即可覆盖输出文件。</p>
</blockquote>
<blockquote>
<p><code>-n</code> 不要覆盖输出文件，如果指定的输出文件已存在，则立即退出。</p>
</blockquote>
<h3><a id="%E6%96%87%E4%BB%B6%E4%B8%BB%E8%A6%81%E6%93%8D%E4%BD%9C%E5%8F%82%E6%95%B0%E9%83%A8%E5%88%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>文件主要操作参数部分</h3>
<p>FFmpeg的文件主要操作参数部分的常用命令如下所示：</p>
<pre class="line-numbers"><code class="language-plain_text">-i url              input file url
-f fmt              force format
-c codec            codec name
-codec codec        codec name
-pre preset         preset name
-map_metadata outfile[,metadata]:infile[,metadata]  set metadata information of outfile from infile
-t duration         record or transcode &quot;duration&quot; seconds of audio/video
-to time_stop       record or transcode stop time
-fs limit_size      set the limit file size in bytes
-ss time_off        set the start time offset
-sseof time_off     set the start time offset relative to EOF
-seek_timestamp     enable/disable seeking by timestamp with -ss
-timestamp time     set the recording timestamp ('now' to set the current time)
-metadata string=string  add metadata
-program title=string:st=number...  add program with specified streams
-target type        specify target file type (&quot;vcd&quot;, &quot;svcd&quot;, &quot;dvd&quot;, &quot;dv&quot; or &quot;dv50&quot; with optional prefixes &quot;pal-&quot;, &quot;ntsc-&quot; or &quot;film-&quot;)
-apad               audio pad
-frames number      set the number of frames to output
-filter filter_graph  set stream filtergraph
-filter_script filename  read stream filtergraph description from a file
-reinit_filter      reinit filtergraph on input parameter changes
-discard            discard
-disposition        disposition
</code></pre>
<blockquote>
<p><code>-f</code> 强制指定输入或输出文件格式。输入文件的格式通常是自动检测的，而输出文件的格式是根据文件扩展名推断的，因此在大多数情况下不需要此选项。</p>
</blockquote>
<blockquote>
<p><code>-c[:stream_specifier] codec (input/output,per-stream)</code></p>
</blockquote>
<blockquote>
<p><code>-codec[:stream_specifier] codec (input/output,per-stream)</code></p>
</blockquote>
<p>为一个或多个流选择编码器（在输出文件之前使用时）或解码器（在输入文件之前使用时）。codec是解码器/编码器的名称或特殊值copy（仅用于输出），用于指示流不做重编码工作。</p>
<p>例如：</p>
<pre class="line-numbers"><code class="language-plain_text"> ./ffmpeg -i INPUT -map 0 -c:v libx264 -c:a copy OUTPUT
</code></pre>
<p>使用libx264对所有视频流进行编码，并复制所有音频流。</p>
<blockquote>
<p><code>-t duration (input/output)</code> 当用作输入选项（在-i之前）时，限制从输入文件读取数据的持续时间。当用作输出选项时（在输出url之前），在输出持续时间达到持续时间后停止写入输出。<code>-to</code>和<code>-t</code>是互斥的，并且<code>-t</code>具有更高优先级。</p>
</blockquote>
<blockquote>
<p><code>-to position (input/output)</code> 在指定位置停止写入输出或读取输入。</p>
</blockquote>
<blockquote>
<p><code>-fs limit_size (output)</code> 设置文件大小限制，以字节表示。超过限制后，不再写入更多的字节块。通常输出文件的大小会略大于设置的文件大小。</p>
</blockquote>
<blockquote>
<p><code>-metadata[:metadata_specifier] key=value (output,per-metadata)</code> 设置metadata键/值对，也可以使用空值删除metadata。</p>
</blockquote>
<p>例如，要在输出文件中设置标题：</p>
<pre class="line-numbers"><code class="language-plain_text">  ./ffmpeg -i in.avi -metadata title=&quot;my title&quot; out.flv
</code></pre>
<p>要设置第一个音频流的语言，请执行以下操作：</p>
<pre class="line-numbers"><code class="language-plain_text"> ./ffmpeg -i INPUT -metadata:s:a:0 language=eng OUTPUT
</code></pre>
<h3><a id="%E8%A7%86%E9%A2%91%E6%93%8D%E4%BD%9C%E5%8F%82%E6%95%B0%E9%83%A8%E5%88%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>视频操作参数部分</h3>
<p>FFmpeg的视频操作参数部分的常用命令如下所示：</p>
<pre class="line-numbers"><code class="language-plain_text">-vframes number     set the number of video frames to output
-r rate             set frame rate (Hz value, fraction or abbreviation)
-fpsmax rate        set max frame rate (Hz value, fraction or abbreviation)
-s size             set frame size (WxH or abbreviation)
-aspect aspect      set aspect ratio (4:3, 16:9 or 1.3333, 1.7777)
-bits_per_raw_sample number  set the number of bits per raw sample
-vn                 disable video
-vcodec codec       force video codec ('copy' to copy stream)
-timecode hh:mm:ss[:;.]ff  set initial TimeCode value.
-pass n             select the pass number (1 to 3)
-vf filter_graph    set video filters
-ab bitrate         audio bitrate (please use -b:a)
-b bitrate          video bitrate (please use -b:v)
-dn                 disable data
</code></pre>
<blockquote>
<p><code>-vframes number (output)</code> 设置要输出的视频帧数。这是<code>-frames:v</code>的废弃的别名，您应该改用-<code>frames:v</code>。</p>
</blockquote>
<blockquote>
<p><code>-r[:stream_specifier] fps (input/output,per-stream)</code> 设置帧速率（Hz值、分数或缩写）。</p>
</blockquote>
<p>作为一个输入选项，忽略文件中存储的任何时间戳，而是假设恒定帧速率fps生成时间戳.</p>
<p>作为输出选项，复制或删除输入帧以实现恒定的输出帧速率fps。</p>
<p>例如设置帧率为29.97fps，下面三种方式具有相同的结果：</p>
<pre class="line-numbers"><code class="language-plain_text">./ffmpeg -i input.avi -r 29.97 output.mp4
./ffmpeg -i input.avi -r 30000/1001 output.mp4 
./ffmpeg -i input.avi -r netsc output.mp4
</code></pre>
<blockquote>
<p><code>-fpsmax[:stream_specifier] fps (output,per-stream)</code> 设置最大帧速率（Hz值、分数或缩写）。</p>
</blockquote>
<p>当输出帧速率为自动设置且高于此值时，钳制输出帧速率。在批处理或输入帧率错误检测为非常高时有用。它不能与-r一起设置。在streamcopy期间将忽略它。</p>
<blockquote>
<p><code>-s[:stream_specifier] size (input/output,per-stream)</code> 设置帧大小。</p>
</blockquote>
<blockquote>
<p><code>-aspect[:stream_specifier] aspect (output,per-stream)</code> 设置视频文件的宽高比。</p>
</blockquote>
<p>宽高比可以是浮点数字符串，也可以是形式为num:den的字符串，其中num和den是宽高比的分子和分母。例如，“4:3”、“16:9”、“1.3333”和“1.7777”都是有效的参数值。</p>
<blockquote>
<p><code>-ab bitrate</code> 设置音频码率。推荐使用<code>-b:a</code>。</p>
</blockquote>
<blockquote>
<p><code>-b bitrate</code> 设置视频码率，推荐使用<code>-b:v</code>。</p>
</blockquote>
<h4><a id="%E8%A7%86%E9%A2%91%E5%89%AA%E5%88%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>视频剪切</h4>
<p>基本剪切，指定起始时间、剪切时长：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -ss 10 -t 20 -codec copy cut.mp4
</code></pre>
<p>精确剪切，包含多音轨，-map 0代表所有track流进行剪切，-accurate_seek代表精确seek：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -ss 10 -accurate_seek -t 20 -map 0 -codec copy cut.mp4
</code></pre>
<h4><a id="%E8%A7%86%E9%A2%91%E8%BD%AC%E7%A0%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>视频转码</h4>
<p>使用-vcodec指定视频编码，-acodec指定音频编码，-s 640x480指定视频分辨率，-b 200k指定码率，-r 20指定帧率，这样达到视频压缩效果：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -vcodec libx264 -acodec aac -s 640x480 -b 200k -r 20 transcode.mp4
</code></pre>
<h4><a id="%E8%A7%86%E9%A2%91%E6%88%AA%E5%9B%BE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>视频截图</h4>
<p>使用-vframes指定截图数量，-ss指定起始时间放在-i前面，这样保证先seek到指定位置再截图。<br />
如果是先-i指定输入文件再-ss，是从时间0开始解码，直到指定时间再截图，这样效率太低：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -ss 10 -i input.mp4 -f image2 -vframes 1 -an screenshot.jpg
</code></pre>
<h4><a id="%E5%9B%BE%E7%89%87%E6%B0%B4%E5%8D%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>图片水印</h4>
<p>使用-filter_complex指定位置overlay=x:y，如下所示：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -i logo.png -filter_complex overlay=10:20 pic_watermark.mp4
</code></pre>
<p>如果要灵活设置左上角、右上角、左下角、右下角位置，可以使用case语句，其中main_w代表视频宽度，<br />
main_h代表视频高度，overlay_w代表水印宽度，overlay_h代表水印高度：</p>
<pre class="line-numbers"><code class="language-plain_text">public static String obtainOverlay(int offsetX, int offsetY, int location) {
    switch (location) {
        case 2:
            return &quot;overlay='(main_w-overlay_w)-&quot; + offsetX + &quot;:&quot; + offsetY + &quot;'&quot;;
        case 3:
            return &quot;overlay='&quot; + offsetX + &quot;:(main_h-overlay_h)-&quot; + offsetY + &quot;'&quot;;
        case 4:
            return &quot;overlay='(main_w-overlay_w)-&quot; + offsetX + &quot;:(main_h-overlay_h)-&quot; + offsetY + &quot;'&quot;;
        case 1:
        default:
            return &quot;overlay=&quot; + offsetX + &quot;:&quot; + offsetY;
    }
}

public static String[] addWaterMarkImg(String inputPath, String imgPath, int location,
                                           int offsetXY, String outputPath) {
    String overlay = obtainOverlay(offsetXY, offsetXY, location);
    String waterMarkCmd = &quot;ffmpeg -i %s -i %s -filter_complex %s -preset:v superfast %s&quot;;
    waterMarkCmd = String.format(waterMarkCmd, inputPath, imgPath, overlay, outputPath);
    return waterMarkCmd.split(&quot; &quot;);
}
</code></pre>
<h4><a id="gif%E6%B0%B4%E5%8D%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>GIF水印</h4>
<p>使用-ignore_loop 0代表GIF循环显示，其他操作与图片水印一致：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -ignore_loop 0 -i logo.gif -filter_complex overlay=10:20 gif_mark.mp4
</code></pre>
<h4><a id="%E5%8E%BB%E9%99%A4%E6%B0%B4%E5%8D%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>去除水印</h4>
<p>使用delogo命令，然后指定水印位置：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -filter_complex delogo=x=10:y=20:w=90:h=30 delogo.mp4
</code></pre>
<h4><a id="%E8%A7%86%E9%A2%91%E6%8B%BC%E6%8E%A5" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>视频拼接</h4>
<p>视频拼接分为垂直拼接、水平拼接，还有前后拼接，这里主要介绍垂直与水平拼接，其中使用hstack做水平拼接，vstack做垂直拼接：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input1.mp4 -i input2.mp4 -filter_complex hstack out.mp4
</code></pre>
<h4><a id="%E8%A7%86%E9%A2%91%E7%BF%BB%E8%BD%AC" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>视频翻转</h4>
<p>使用reverse实现视频翻转，但是处理比较耗时：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -vf reverse -an output.mp4
</code></pre>
<h4><a id="%E8%A7%86%E9%A2%91%E9%99%8D%E5%99%AA" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>视频降噪</h4>
<p>使用-nr代表noise reduction，进行视频降噪：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i in.mp4 -nr 500 out.mp4
</code></pre>
<h4><a id="%E8%A7%86%E9%A2%91%E6%8A%BD%E5%B8%A7" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>视频抽帧</h4>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -ss 20 -accurate_seek -t 10 -i input.mp4 -an -r 5 %3d.jpg
</code></pre>
<h4><a id="%E6%92%AD%E6%94%BE%E9%80%9F%E5%BA%A6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>播放速度</h4>
<p>使用setpts设置视频速度，atempo设置音频速度：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i in.mp4 -filter_complex [0:v]setpts=%.2f*PTS[v];[0:a]atempo=%.2f[a] -map [v] -map [a] out.mp4
</code></pre>
<h4><a id="%E9%BB%91%E7%99%BD%E8%A7%86%E9%A2%91" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>黑白视频</h4>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i in.mp4 -vf lutyuv='u=128:v=128' out.mp4
</code></pre>
<h3><a id="%E9%9F%B3%E9%A2%91%E6%93%8D%E4%BD%9C%E5%8F%82%E6%95%B0%E9%83%A8%E5%88%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>音频操作参数部分</h3>
<p>FFmpeg的音频操作参数部分的常用命令如下所示：</p>
<pre class="line-numbers"><code class="language-plain_text">-aframes number     set the number of audio frames to output
-aq quality         set audio quality (codec-specific)
-ar rate            set audio sampling rate (in Hz)
-ac channels        set number of audio channels
-an                 disable audio
-acodec codec       force audio codec ('copy' to copy stream)
-vol volume         change audio volume (256=normal)
-af filter_graph    set audio filters
</code></pre>
<p>示例</p>
<blockquote>
<p><code>aframes number (output)</code> 设置要输出的音频帧数。这是<code>-frames:a</code>的废弃的别名，您应该改用-<code>frames:a</code>。</p>
</blockquote>
<blockquote>
<p><code>-ar[:stream_specifier] freq (input/output,per-stream)</code> 设置音频采样频率。</p>
</blockquote>
<blockquote>
<p><code>-aq q (output)</code> 设置音频质量（特定于编解码器，VBR）。这是-q:a的别名。</p>
</blockquote>
<blockquote>
<p><code>-ac[:stream_specifier] channels (input/output,per-stream)</code> 设置音频通道的数量。</p>
</blockquote>
<blockquote>
<p><code>-sample_fmt[:stream_specifier] sample_fmt (output,per-stream)</code> 设置音频采样格式。可以通过<code>-sample_fmts</code>查看支持的采样格式。</p>
</blockquote>
<h4><a id="%E9%9F%B3%E9%A2%91%E8%BD%AC%E7%A0%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>音频转码</h4>
<p><em>直接转码</em>:</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp3 output.m4a
</code></pre>
<p><em>指定编码器、采样率、声道数转码</em>:</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp3 -acodec aac -ac 2 -ar 44100 output.m4a
</code></pre>
<h4><a id="%E9%9F%B3%E9%A2%91%E5%89%AA%E5%88%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>音频剪切</h4>
<p><em>-ss 10指定从第10秒开始，-t 20代表剪切20秒</em>:</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp3 -ss 10 -t 20 cut.mp3
</code></pre>
<h4><a id="%E9%9F%B3%E9%A2%91%E6%8B%BC%E6%8E%A5" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>音频拼接</h4>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i concat:&quot;hello.mp3|world.mp3&quot; -acodec copy -vn concat.mp3
</code></pre>
<h4><a id="%E9%9F%B3%E9%A2%91%E6%B7%B7%E9%9F%B3" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>音频混音</h4>
<p>使用amix，参数inputs代表输入流个数，duration有longest、shortest、first三种模式，weights设置每条流音量权重占比：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i hello.mp3 -i world.mp3 -filter_complex amix=inputs=2:duration=first -vn mix.mp3
</code></pre>
<p>使用amerge，合并成多声道输出：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i hello.mp3 -i world.mp3 -filter_complex [0:a][1:a]amerge=inputs=2[aout] -map [aout] merge.mp3
</code></pre>
<h4><a id="%E7%A9%BA%E7%81%B5%E9%9F%B3%E6%95%88" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>空灵音效</h4>
<p>aecho接收4个参数：in_gain (0, 1]；out_gain (0, 1]；delays (0 - 90000]；decays (0 - 1.0]</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp3 -af aecho=0.8:0.8:1000:0.5 echo.mp3
</code></pre>
<h4><a id="%E6%83%8A%E6%82%9A%E9%9F%B3%E6%95%88" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>惊悚音效</h4>
<p>tremolo接收2个参数：frequency [0.1, 20000.0]；depth (0, 1]</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp3 -af tremolo=5:0.9 tremolo.mp3
</code></pre>
<h4><a id="%E6%90%9E%E7%AC%91%E9%9F%B3%E6%95%88" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>搞笑音效</h4>
<p>搞笑音效通过调节音速实现，使用atempo：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp3 -filter_complex atempo=0.5 atempo.mp3
</code></pre>
<h4><a id="%E9%9D%99%E9%9F%B3%E6%A3%80%E6%B5%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>静音检测</h4>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp3 -af silencedetect=noise=0.0001 -f null -
</code></pre>
<h4><a id="%E4%BF%AE%E6%94%B9%E9%9F%B3%E9%87%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>修改音量</h4>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp3 -af volume=0.5 volume.mp3
</code></pre>
<h4><a id="%E6%8A%BD%E5%8F%96%E9%9F%B3%E9%A2%91" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>抽取音频</h4>
<p>从视频抽取音频，直接disable视频流：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -vn out.mp3
</code></pre>
<p>从视频抽取音频，disable视频流，音频进行转码：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -acodec aac -vn out.m4a
</code></pre>
<p>从视频抽取音频，如果存在多音轨，可指定某个音轨：</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -map 0:1 -vn out.mp3
</code></pre>
<h3><a id="%E5%AD%97%E5%B9%95%E6%93%8D%E4%BD%9C%E5%8F%82%E6%95%B0%E9%83%A8%E5%88%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>字幕操作参数部分</h3>
<p>FFmpeg的字幕操作参数部分的常用命令如下所示：</p>
<pre class="line-numbers"><code class="language-plain_text">-s size             set frame size (WxH or abbreviation)
-sn                 disable subtitle
-scodec codec       force subtitle codec ('copy' to copy stream)
-stag fourcc/tag    force subtitle tag/fourcc
-fix_sub_duration   fix subtitles duration
-canvas_size size   set canvas size (WxH or abbreviation)
-spre preset        set the subtitle options to the indicated preset
</code></pre>
<blockquote>
<p><code>-scodec codec (input/output)</code> 设置字幕编解码器。这是-codec:s的别名。</p>
</blockquote>
<blockquote>
<p><code>-canvas_size size</code> 设置用于渲染字幕的画布的大小。</p>
</blockquote>
<blockquote>
<p><code>-fix_sub_duration</code> 修正字幕持续时间。对于每个字幕，等待同一流中的下一个数据包，并调整第一个数据包的持续时间以避免重叠。对于某些字幕编解码器，尤其是DVB字幕，这是必要的，因为原始数据包中的持续时间只是一个粗略估计，而结束实际上是由一个空字幕帧标记的。如果在必要时不使用此选项，可能会由于非单调时间戳而导致持续时间过长或复用失败。</p>
</blockquote>
<p>请注意，此选项将延迟所有数据的输出，直到下一个字幕数据包被解码：它可能会大大增加内存消耗和延迟。</p>
<h2><a id="ffmpeg%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%AD%97%E7%AC%A6%E5%91%BD%E4%BB%A4" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>FFmpeg的基本字符命令</h2>
<ul>
<li><code>-i</code> 输入文件的地址</li>
<li><code>-y</code> 表示直接覆盖已经存在的输出文件</li>
<li><code>-n</code> 表示若某个输出文件已经存在则退出(若没有设置-y或-n选项，且某个输出文件已经存在ffmpeg会询问是否要覆盖输出文件)</li>
<li><code>-codec(-c)</code> 指定输入输出的解码编码器 copy 则将输入流直接复制到输出流不进行编解码操作</li>
<li><code>-c:v 或-vcodec</code> 可以为所有视频流指定编码器，-c:v:1为第2个视频流指定编解码器。xvid（使用XVID编码压缩视频，不能改的）</li>
<li><code>-c:a 或-acodec</code> 可以为所有音频流指定编码器，-c:a:12为第13个视频流指定编解码器。</li>
<li><code>-pixel_format/-pix_fmt</code>  指定转换格式 例:yuv420p</li>
<li><code>-vol</code> 音量</li>
<li><code>-ss</code> 选项用于设置流的开始时间，可以设置输入输出或者滤镜。在开始时间之前的帧将被跳过不被处理(输入不被解码，输出不被编码，滤镜不被处理)。例:ffmpeg -ss 2 -t 10 -i test.mp4 test.mov。时长的格式:如-t 10, -t 23.167 时分秒: 如-t 10:23, -t 21:31:00.233</li>
<li><code>-t</code> 选项用于用于设置输入输出，-t在-i前可以限制输入时长，-t在输出文件前可以限制输出时长</li>
<li><code>-to</code> 选项类似于-t选项，不同的是-to指定结束时刻，-t指定持续时间</li>
<li><code>-f</code> 强制设置输入输出的文件格式，默认情况下ffmpeg会根据文件后缀名判断文件格式</li>
<li><code>-filter / -filter_complex</code> 使用过滤器对流进行处理 复杂过滤器</li>
<li><code>-vf</code> 代替-filter:v处理视频流</li>
<li><code>-af</code> 代替-filter:a处理音频流</li>
<li><code>-vframes</code> 设置要输出的视频帧的数量: 例:ffmpeg -i test.mp4 -vframes 10 test.mov</li>
<li><code>-aframes</code> 设置要输出的音频帧的数量。这是-frames：a的一个过时的别名。</li>
<li><code>-vn</code> 不将视频流写到输出文件中无视频的意思 例:ffmpeg -i test.mp4 -vn -a:c copy out.mp3</li>
<li><code>-an</code> 不将音频流写到输出文件中无音频的意思 例:ffmpeg -i test.mp4 -v:c copy -an out.mp4</li>
<li><code>-r</code> 设置某个流的帧率按ffmpeg官方文档说-r与-framerate作用相同，但实际测试时发现不同。-framerate 用于限制输入，而-r用于限制输出 例:ffmpeg -i test.mp4 -r:v 30 test.mov</li>
<li><code>-re</code> 代表按照帧率发送，尤其在作为推流工具的时候一定要加入该参数，否则ffmpeg会按照最高速率向流媒体服务器不停地发送数据。</li>
<li><code>-s</code> 设置帧的大小 例:ffmpeg -i test.mp4 -s 1080x680 out.mp4</li>
<li><code>-fs</code> 设置文件大小的上限</li>
<li><code>-aspect [：stream_specifier]</code> 宽高比（输出，每个流） 设置方面指定的视频显示宽高比。aspect可以是浮点数字符串，也可以是num：den形式的字符串，其中num和den是宽高比的分子和分母。例如“4：3”，“16：9”，“1.3333”和“1.7777”是有效的参数值。如果与-vcodec副本一起使用，则会影响存储在容器级别的宽高比，但不会影响存储在编码帧中的宽高比（如果存在）。</li>
<li><code>-threads</code> 设置处理线程数 例:ffmpeg -threads 8 -i test.mp4 out.mp4</li>
<li><code>-shortest</code> 当最短的输入流结束后即停止编码和输出 例:ffmpeg -i bgm.mp3 -i test.mp4 -shortest output.mp4</li>
<li><code>-sample_fmts</code> 设置音频采样格式。使用-sample_fmts获取支持的样本格式列表。</li>
<li><code>-b:a</code> 指定音频码率。 b 是 bitrate的缩写, a是 audio的缩写</li>
<li><code>-b:v</code> 指定视频码率。 b 是 bitrate的缩写, v是 video的缩写</li>
<li><code>-loop</code> 循环输入流。只工作于图像流</li>
<li><code>-bitexact</code> 使用标准比特率</li>
<li><code>-vb</code> 指定视频比特率（bits/s）</li>
<li><code>-croptop size</code>：设置顶部切除尺寸（in pixels）。</li>
<li><code>-cropbottom size</code>：设置底部切除尺寸（in pixels）。</li>
<li><code>-cropleft size</code>：设置左切除尺寸（in pixels）。</li>
<li><code>-cropright size</code>：设置右切除尺寸（in pixels）。</li>
<li><code>-padtop size</code>：设置顶部补齐尺寸（in pixels）。</li>
<li><code>-padbottom size</code>：底补齐（in pixels）。</li>
<li><code>-padleft size</code>：左补齐（in pixels）。</li>
<li><code>-padright size</code>：右补齐（in pixels）。</li>
<li><code>-padcolor color</code>：补齐带颜色（000000-FFFFFF）。</li>
<li><code>-vcodec codec</code>：强制使用codec编解码方式（'copy’代表不进行重新编码）</li>
<li><code>-aq quality</code>：设置音频质量（指定编码）。</li>
<li><code>-ar rate</code>：设置音频采样率（单位为Hz）。</li>
<li><code>-ac channels</code>：设置声道数，1就是单声道，2就是立体声。</li>
<li><code>-an</code>：取消音频轨。</li>
<li><code>-acodec codec</code>：指定音频编码（'copy’代表不做音频转码，直接复制）。</li>
</ul>
<h2><a id="filter%E6%BB%A4%E9%95%9C" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Filter(滤镜)</h2>
<h3><a id="%E5%A4%8D%E6%9D%82%E8%BF%87%E6%BB%A4%E5%99%A8filter-complex" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>复杂过滤器(filter_complex)</h3>
<p>过滤器会对已解码的帧进行处理，处理后的帧会被重新编码输出</p>
<h3><a id="scale" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>scale</h3>
<p>指定操作源的大小,iw指定按整型取视频的宽度，ih指定按整型取视频的高度。-1为按原图比例变化 例:iw/2:-1视频缩小一倍</p>
<h3><a id="overlay" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>overlay</h3>
<p>指定操作源摆放的位置 overlay=30:10 main_w和main_h为底层视频的宽和高，overlay_w和overlay_h为叠加视频的宽和高</p>
<h3><a id="delogo" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>delogo</h3>
<p>删除水印 例：delogo=x=800:y=20:w=70:h=80</p>
<h3><a id="crop" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>crop</h3>
<p>裁剪 格式：crop=out_w:out_h: x :y<br />
out_w: 输出的宽度。可以使用 in_w 表式输入视频的宽度。<br />
out_h: 输出的高度。可以使用 in_h 表式输入视频的高度。<br />
x : X坐标<br />
y : Y坐标<br />
x和y 设置为 0,说明从左上角开始裁剪。如果不写是从中心点裁剪</p>
<h3><a id="setpts" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>setpts</h3>
<p>setpts=0.5*PTS表示每帧视频的pts时间戳都乘0.5，也就是视频加快一倍</p>
<h3><a id="map" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>-map</h3>
<p>可用于处理复杂输出，如可以将指定的多路流输出到一个输出文件，也可以指定输出到多个文件。&quot;[v]&quot; 复杂滤镜输出的别名作为输出文件的一路流。上面 map的用法是将复杂滤镜输出的视频和音频输出到指定文件中。</p>
<h2><a id="%E6%B0%B4%E5%B9%B3%E7%BF%BB%E8%BD%AChflip" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>水平翻转hflip</h2>
<h3><a id="%E9%95%9C%E5%83%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>镜像</h3>
<p>crop=iw/2:ih:0:0,split[left][tmp];[tmp]hflip[right]</p>
<h3><a id="%E5%90%84%E7%A7%8D%E7%89%B9%E6%95%88curves" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>各种特效curves</h3>
<p>curves='vintage'(复古) 'strong_contrast'（强对比度）'lighter'(变亮) 'negate'(底片) 'none' 'color_negative'(彩色底片);</p>
<h3><a id="%E8%BE%B9%E7%BC%98%E6%A3%80%E6%B5%8Bedgedetect" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>边缘检测edgedetect</h3>
<h3><a id="%E5%85%89%E6%99%95vignette-pi4" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>光晕vignette=PI/4</h3>
<h3><a id="%E5%8F%98%E6%9A%97" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>变暗</h3>
<p>colorlevels=rimin=0.058:gimin=0.058:bimin=0.058</p>
<h3><a id="%E5%A2%9E%E5%8A%A0%E5%AF%B9%E6%AF%94%E5%BA%A6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>增加对比度</h3>
<p>fftfilt=dc_Y=0:weight_Y='exp(-4 * ((Y+X)/(W+H)))</p>
<h3><a id="%E9%99%8D%E5%99%AA" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>降噪</h3>
<p>hqdn3d=luma_spatial=15.0</p>
<h3><a id="%E9%94%90%E5%8C%96" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>锐化</h3>
<p>fftfilt=dc_Y=0:weight_Y='1+squish(1-(Y+X)/100)'</p>
<h3><a id="%E4%BD%8E%E9%80%9A%E6%BB%A4%E6%B3%A2" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>低通滤波</h3>
<p>fftfilt=dc_Y=0:weight_Y='squish((Y+X)/100-1)'</p>
<h3><a id="%E9%AB%98%E9%80%9A%E6%BB%A4%E6%B3%A2" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>高通滤波</h3>
<p>fftfilt=dc_Y=128:weight_Y='squish(1-(Y+X)/100)'</p>
<h3><a id="fade%E8%A7%86%E9%A2%91%E6%B7%A1%E5%85%A5%E6%B7%A1%E5%87%BA%E6%95%88%E6%9E%9C" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>fade 视频淡入淡出效果</h3>
<p>例：fade=in:0:25, fade=out:975:25 从0桢开始淡入25帧，从975开始淡出25帧<br />
fade=in:5:20:color=yellow 开始淡入前为黄色<br />
fade=in:0:25:alpha=1 淡入完成后过去15帧的透明度<br />
fade=t=in:st=5.5:d=0.5 5.5秒开始，淡入0.5秒 d为时长<br />
fps滤镜通过删除帧或者复制帧的方法强制设置帧率 例:ffmpeg -y -i test.mp4 -vf &quot;fps=60&quot; out.mp4</p>
<h2><a id="%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>常用命令</h2>
<h3><a id="%E5%89%AA%E5%88%87%E5%A4%9A%E4%B8%AA%E6%96%87%E4%BB%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>剪切多个文件</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -t 00:00:50 -c copy small-1.mp4 -ss 00:00:50 -codec copy small-2.mp4
</code></pre>
<h3><a id="%E8%A7%86%E9%A2%91%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>视频格式转换</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i out.mp4 -y out.avi
</code></pre>
<h3><a id="%E8%A7%86%E9%A2%91%E8%BD%ACgif" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>视频转Gif</h3>
<p><strong>视频转Gif</strong></p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i out.mp4 -y out.gif
</code></pre>
<p><strong>从0开始截10s转Gif</strong></p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i out.mp4 -ss 00:00:00 -t 10 -y out.gif
</code></pre>
<h3><a id="%E8%A7%86%E9%A2%91%E8%BD%AC%E5%A4%9A%E5%BC%A0%E5%9B%BE%E7%89%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>视频转多张图片</h3>
<p><strong>每秒生成一个张图片</strong></p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input_test.mp4 -vf fps=1 out%03d.png
</code></pre>
<p><strong>每分钟生成一张图片</strong></p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input_test.mp4 -vf fps=1/60 out%03d.png
</code></pre>
<p><strong>截取视频中的某段视频</strong></p>
<p>截取从2s开始10秒的视频</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -ss 2 -i test.mp4 -t 10 -y -f out_test.mp4
</code></pre>
<p><strong>视频分片（把视频切为一段一段）</strong></p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i test.mp4 -c copy -map 0 -f segment -segment_time 10 video/part-%d.mp4
</code></pre>
<p><strong>截取视频中某个时间段的单张图片或多张图片</strong></p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -ss 2 -i test.mp4 -r 1 -t 2 -y -f image2 image-%3.jpeg
</code></pre>
<p><strong>单张图片或多张图片转视频</strong></p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -loop 1 -i img%3d.png -t 10-y output.mp4
</code></pre>
<h3><a id="gif%E8%BD%AC%E8%A7%86%E9%A2%91" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Gif转视频</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.gif -y output.mp4
</code></pre>
<h3><a id="%E5%A4%9A%E4%B8%AA%E8%A7%86%E9%A2%91%E5%90%88%E5%B9%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>多个视频合并</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i &quot;concat:input1.mp4|input2.mp4|input3.mp4&quot; -c copy output.mp4
</code></pre>
<h3><a id="%E4%BF%AE%E6%94%B9%E8%A7%86%E9%A2%91%E5%88%86%E8%BE%A8%E7%8E%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>修改视频分辨率</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input_test.mp4 -s 320*240 out_test.mp4
</code></pre>
<h3><a id="%E7%BB%99%E8%A7%86%E9%A2%91%E6%B7%BB%E5%8A%A0%E9%9F%B3%E9%A2%91" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>给视频添加音频</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -i input1.mp3 -y output.mp4
</code></pre>
<h3><a id="%E6%8F%90%E5%8F%96%E8%A7%86%E9%A2%91%E4%B8%AD%E7%9A%84%E9%9F%B3%E9%A2%91" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>提取视频中的音频</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i test.mp4 -vn -a:c copy out.mp3
</code></pre>
<h3><a id="%E8%A7%86%E9%A2%91%E9%9D%99%E9%9F%B3" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>视频静音</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -an -vcodec copy output.mp4
</code></pre>
<h3><a id="%E9%9F%B3%E9%A2%91%E5%90%88%E5%B9%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>音频合并</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i &quot;concat:test1.mp3|test2.mp3&quot; -acodec copy output.mp3
</code></pre>
<h2><a id="%E9%AB%98%E7%BA%A7%E5%91%BD%E4%BB%A4" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>高级命令</h2>
<h3><a id="%E9%9F%B3%E9%A2%91%E6%B7%B7%E9%9F%B3" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>音频混音</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input_01.wav -i input_02.wav -filter_complex amix=inputs=2:duration=shortest:dropout_transition=3 output.wav
</code></pre>
<p>以两个音频文件时长较短的音频文件时长作为最终输出的时长</p>
<ul>
<li><code>inputs</code>: 输入的数量，如果没有指明，默认为2.</li>
<li><code>duration</code>: 决定了流的结束</li>
<li><code>longest</code>: 最长输入的持续时间</li>
<li><code>shortest</code>:最短输入的持续时间</li>
<li><code>first</code>: 第一个输入的持续时间</li>
<li><code>dropout_transition</code>: 输入流结束时（音频）容量重整化的转换时间（以秒为单位）。 默认值为2秒。</li>
</ul>
<h3><a id="%E6%B7%BB%E5%8A%A0%E6%96%87%E5%AD%97%E6%B0%B4%E5%8D%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>添加文字水印</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -y -i test.mp4 -vf &quot;drawtext=fontfile=CourierNew.ttf:text='hello world':x=100:y=50:fontsize=24&quot; out.mp4
</code></pre>
<h3><a id="%E6%B7%BB%E5%8A%A0%E5%9B%BE%E7%89%87%E6%B0%B4%E5%8D%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>添加图片水印</h3>
<p><strong>添加单个图片水印</strong></p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -i water.png -filter_complex &quot;[0:v][1:v]overlay=main_w-overlay_w-10:10&quot; -y output.mp4
</code></pre>
<p><strong>添加多个图片水印</strong></p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -i photo1.png -i photo2.png -filter_complex &quot;[0:v]fade=in:st=0:d=2,curves=vintage[img];[1:v]scale=300:-1[img1];[img][img1]overlay=10:10[out1];[out1][2:v]overlay=main_w:main_h&quot; -y output.mp4
</code></pre>
<p>添加了两张图片，第一张设置为宽度300，高度-1为根据原图片比例缩放，在视频左上角，第二张图片在视频右下角，fade是淡入淡出效果器，视频效果为从0s开始淡入，淡入2s，视频为复古效果curves=vintage</p>
<h3><a id="%E8%B7%91%E9%A9%AC%E7%81%AF%E6%95%88%E6%9E%9C" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>跑马灯效果</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i video2.mp4 -i logo.png -filter_complex &quot;[1:v]scale=50*50[logo];[0:v]scale=200*200[bg];[bg][logo]overlay=x='if(gte(t,0),-overlay_w+(mod(n,main_w+overlay_w))+5,NAN)':y=0&quot; -y output.mp4
</code></pre>
<p>含义: 时间t大于0，那么就开始从子内容的宽度的x-overlay_w位置开始，然后每一帧n计数，帧数n除以（背景main_w+子内容背景overlay_w）求除数+1设置为x坐标，即可循环<br />
overlay=30:10 main_w和main_h为底层视频的宽和高，overlay_w和overlay_h为叠加视频的宽和高</p>
<h3><a id="%E8%A7%86%E9%A2%91%E5%8E%BB%E6%B0%B4%E5%8D%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>视频去水印</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i test.flv -vf delogo=x=20:y=20:w=70:h=80 output.flv
</code></pre>
<p>x,y ：指定水印的位置，即图片左上角的坐标 w,h：给出水印的宽高</p>
<h3><a id="%E6%B7%BB%E5%8A%A0%E5%8A%A8%E7%94%BB" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>添加动画</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -y -i test.mp4 -t 10 -loop 1 -framerate 6 -i test_%3d.png -filter_comple 'overlay=10:main_h-overlay_h-10' out.mp4
</code></pre>
<p>将多张图片(test_001.png, ani002.png...)组成动画, 然后将这个动画叠加在视频的左下角。-t 10 -loop 1会循环播放动画，持续10s</p>
<h3><a id="%E6%B7%A1%E5%85%A5%E6%B7%A1%E5%87%BA%E6%95%88%E6%9E%9C%E5%99%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>淡入淡出效果器</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmepg -i input.wav -filter_complex afade=t=in:ss=0:d-4 output.wav
</code></pre>
<p>(淡入)把 input 文件的前5s 做一个淡入效果，输出到 output.wav 中</p>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.wav -filter_complex afade=t=out:st=200:d=5 output.wav
</code></pre>
<p>（淡出）将input.wav文件从200s开始，做5s的淡出效果，并放到output.wav文件中</p>
<h3><a id="%E8%A7%86%E9%A2%91%E6%8F%90%E4%BA%AE%E6%95%88%E6%9E%9C%E5%99%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>视频提亮效果器</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.flv -c:v libx264 -b:v 800k -c:a libfdk_aac -vf eq=brightness=0.25 -f mp4 output.mp4
</code></pre>
<p>提亮参数是brightness，取值范围是从-1.0到1.0，默认值是0</p>
<h3><a id="%E4%B8%BA%E8%A7%86%E9%A2%91%E5%A2%9E%E5%8A%A0%E5%AF%B9%E6%AF%94%E5%BA%A6%E6%95%88%E6%9E%9C" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>为视频增加对比度效果</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.flv -c:v libx264 -b:v 800k -c:a libfdk_aac -vf eq=contrast=1.5 -f mp4 output.mp4
</code></pre>
<p>对比度参数是contrast，取值范围是从-2.0到2.0，默认值是1.0</p>
<h3><a id="%E6%88%AA%E5%8F%96%E8%A7%86%E9%A2%91%E5%8C%BA%E5%9F%9F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>截取视频区域</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -an -vf &quot;crop=480:480:120:0&quot; -vcodec libx264 -b:v 800k output.mp4
</code></pre>
<h3><a id="%E6%97%8B%E8%BD%AC%E8%A7%86%E9%A2%91" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>旋转视频</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -vf &quot;transpose=1&quot; -b:v 600k output.mp4
</code></pre>
<h3><a id="%E6%94%B9%E5%8F%98%E8%A7%86%E9%A2%91%E9%9F%B3%E9%87%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>改变视频音量</h3>
<pre class="line-numbers"><code class="language-plain_text">ffmpeg -i input.mp4 -af 'volume=0.5' output.mp4
</code></pre>
<h3><a id="%E5%8E%8B%E7%BC%A9%E8%A7%86%E9%A2%91" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>压缩视频</h3>
<p><code>-preset superfast</code> 可以加快合成视频时间</p>
<p>视频压缩主要是改变视频的码率、比特率和分辨率去压缩,但是需要控制好缩小的码率和分辨率，以保证视频的质量符合你的需求 <code>ffmpeg -i input.mp4 -b:v 600k -y output.mp4</code></p>
<h3><a id="%E6%8E%A8%E8%8D%90%E6%AF%94%E7%89%B9%E7%8E%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>推荐比特率</h3>
<p><figure><img src="media/16530148144447/16530331637619.jpg" alt="" /></figure></p>
<h2><a id="ffplay%E5%91%BD%E4%BB%A4%E8%A1%8C" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ffplay命令行</h2>
<p>ffplay主要用于播放视频，也可以播放网络流。ffplay是以FFmpeg框架为基础，外加渲染音视频的库libSDL来构建的媒体文件播放器。它所依赖的libSDL是1.2版本的，所以在安装ffplay之前也要安装对应版本的libSDL作为其依赖的组件。</p>
<pre class="line-numbers"><code class="language-plain_text">ffplay beyond.mp4
</code></pre>
<p>这时候会弹出一个窗口，一边播放MP3文件，一边将播放声音的语谱图画到该窗口上。针对该窗口的操作如下，点击窗口的任意一个位置，ffplay会按照点击的位置计算出时间的进度，然后跳（seek）到这个时间点上继续播放；按下键盘上的右键会默认快进10s，左键默认后退10s，上键默认快进1min，下键默认后退1min；按ESC键就是退出播放进程；如果按w键则将绘制音频的波形图等。</p>
<p>如果按s键则可以进入frame-step模式，即按s键一次就会播放下一帧图像，这在观察某些视频内部的帧内容时也是常用的技巧。</p>
<ul>
<li><code>-loop [N]</code>: 播放视频结束之后会从头再次播放，共循环播放N次。</li>
<li><code>-ast [N]</code>: 表示播放视频中的第一路音频流，如果参数ast后面跟的是2，那么就播放第二路音频流，如果没有第二路音频流的话，就会静音</li>
<li><code>-vst [N]</code>: 表示播放视频中的第一路视频流，如果参数vst后面跟的是2，那么就播放第二路视频流，但是如果没有第二路视频流，就会是黑屏即什么都不显示。</li>
<li><code>-sync</code>: 指定音画同步策略。 <code>audio</code>/<code>video</code>/<code>ext</code></li>
</ul>
<h3><a id="%E6%92%AD%E6%94%BEpcm%E9%9F%B3%E9%A2%91" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>播放pcm音频</h3>
<pre class="line-numbers"><code class="language-plain_text">ffplay song.pcm -f s16le -channels 2-ar 44100
</code></pre>
<p>仅键入上述这行命令其实就可以正常播放song.pcm了，当然，前提是格式（-f）、声道数（-channels）、采样率（-ar）必须设置正确，如果其中任何一项参数设置不正确，都不会得到正常的播放结果。第1章在讲音频的基础概念时已经提到过，WAV格式的文件称为无压缩的格式，其实就是在PCM的头部添加44个字节，用于标识这个PCM的采样表示格式、声道数、采样率等信息，对于WAV格式音频文件，ffplay肯定可以直接播放，但是若让ffplay播放PCM裸数据的话，只要为其提供上述三个主要的信息，那么它就可以正确地播放了。</p>
<h3><a id="%E9%80%9A%E8%BF%87%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E7%94%9F%E6%88%90%E8%A7%86%E9%A2%91%E5%B8%A7" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>通过原始数据生成视频帧</h3>
<p>若想让ffplay显示一张YUV的原始数据表示的图片，那么需要告诉ffplay一些重要的信息，其中包括格式（-f rawvideo代表原始格式）、表示格式（-pixel_format yuv420p）、宽高（-s 480*480）。</p>
<pre class="line-numbers"><code class="language-plain_text">ffplay -f rawvideo -pixel_format yuv420p -s 480＊480 texture.yuv
</code></pre>
<p>对于RGB表示的图像，其实是一样的，命令如下：</p>
<pre class="line-numbers"><code class="language-plain_text">ffplay -f rawvideo -pixel_format rgb24-s 480＊480 texture.rgb
</code></pre>
<h2><a id="ffprobe%E5%91%BD%E4%BB%A4%E8%A1%8C" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ffprobe命令行</h2>
<p>ffprobe主要用于检测多媒体信息，包括时长、视频分辨率、帧率、音频采样率、声道数、每个stream流信息等等。<br />
支持显示形式包括：json和xml，例如-print_format json</p>
<pre class="line-numbers"><code class="language-plain_text">ffprobe -i input.mp4 -show_streams -show_format -print_format json
</code></pre>
<ul>
<li><code>-show_format</code>: 该命令可以输出格式信息format_name、时间长度duration、文件大小size、比特率bit_rate、流的数目nb_streams等。</li>
<li><code>-print_format</code>: 该命令可以以JSON格式的形式输出具体每一个流最详细的信息，视频中会有视频的宽高信息、是否有b帧、视频帧的总数目、视频的编码格式、显示比例、比特率等信息，音频中会有音频的编码格式、表示格式、声道数、时间长度、比特率、帧的总数目等信息。</li>
<li><code>-show_frames</code>: 显示帧信息</li>
<li><code>-show_packets</code>: 查看包信息</li>
</ul>
<p>如果要显示每帧数据信息，使用-show_frames可以显示pts、packet_size、duration、frame_type等信息：</p>
<pre class="line-numbers"><code class="language-plain_text">ffprobe -i input.mp4 -show_frames
</code></pre>
<p>如果只要显示视频流，使用-select_streams v。其中v代表video，a代表audio，s代表subtitle。</p>
<pre class="line-numbers"><code class="language-plain_text">ffprobe -i input.mp4 -show_frames -select_streams v
</code></pre>


    

      </div>

      <div class="row">
        <div class="large-6 columns">
        <p class="text-left" style="padding:15px 0px;">
      
          <a href="16530371003160.html" 
          title="Previous Post: 编译FFmpeg">&laquo; 编译FFmpeg</a>
      
        </p>
        </div>
        <div class="large-6 columns">
      <p class="text-right" style="padding:15px 0px;">
      
          <a  href="16530147440533.html" 
          title="Next Post: H264">H264 &raquo;</a>
      
      </p>
        </div>
      </div>
      <div class="comments-wrap">
        <div class="share-comments">
          

          

          
        </div>
      </div>
    </div><!-- article-wrap -->
  </div><!-- large 8 -->




 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="media/16898402251241/logo.jpeg" /></div>
            
                <h1>MagicalRice的Blog</h1>
                <div class="site-des">技术博客</div>
                <div class="social">











  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="Android.html"><strong>Android</strong></a>
        
            <a href="%E6%9C%8D%E5%8A%A1%E5%99%A8.html"><strong>服务器</strong></a>
        
            <a href="C++.html"><strong>C++</strong></a>
        
            <a href="UI.html"><strong>UI</strong></a>
        
            <a href="%E4%BB%A3%E7%A0%81%E4%B9%8B%E7%BE%8E.html"><strong>代码之美</strong></a>
        
            <a href="Game.html"><strong>Game</strong></a>
        
            <a href="Python.html"><strong>Python</strong></a>
        
            <a href="Mac.html"><strong>Mac</strong></a>
        
            <a href="%E5%85%B6%E4%BB%96.html"><strong>其他</strong></a>
        
            <a href="Flutter.html"><strong>Flutter</strong></a>
        
            <a href="ReactNative.html"><strong>ReactNative</strong></a>
        
            <a href="Java.html"><strong>Java</strong></a>
        
            <a href="%E9%9F%B3%E8%A7%86%E9%A2%91%E5%BC%80%E5%8F%91.html"><strong>音视频开发</strong></a>
        
            <a href="%E7%BD%91%E7%BB%9C.html"><strong>网络</strong></a>
        
            <a href="%E7%BD%91%E9%A1%B5.html"><strong>网页</strong></a>
        
            <a href="%E5%B7%A5%E5%85%B7-1-2.html"><strong>工具</strong></a>
        
            <a href="%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD.html"><strong>人工智能</strong></a>
        
            <a href="%E5%88%9B%E4%B8%9A.html"><strong>创业</strong></a>
        
            <a href="%E6%80%9D%E7%BB%B4%E6%8F%90%E5%8D%87.html"><strong>思维提升</strong></a>
        
            <a href="GPU%E6%B8%B2%E6%9F%93.html"><strong>GPU渲染</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="16946950953153.html">Debian 关闭休眠</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="16946000122919.html">Debian 查看 Linux 硬盘大小、类型和硬件信息</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="16945997927114.html">Debian 查看硬件温度</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="16945994928906.html">Debian 查看Linux版本</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="16945989810086.html">Debian 查看CPU和内存</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>

<style>.mweb-charts{background:#fff;}
body{ box-sizing: border-box;
    margin: 0 auto;}
@media print{
    pre, code, pre code {
     overflow: visible !important;
     white-space: pre-wrap !important;       /* css-3 */
     white-space: -moz-pre-wrap !important;  /* Mozilla, since 1999 */
     white-space: -pre-wrap !important;      /* Opera 4-6 */
     white-space: -o-pre-wrap !important;    /* Opera 7 */
     word-wrap: break-word !important;       /* Internet Explorer 5.5+ */
    }
    html,body{margin:0;padding:4px;}
}



div.code-toolbar {
  position: relative;
}

div.code-toolbar > .toolbar {
  position: absolute;
  z-index: 10;
  top: .3em;
  right: .2em;
  transition: opacity 0.3s ease-in-out;
  opacity: 0;
}

div.code-toolbar:hover > .toolbar {
  opacity: 1;
}

/* Separate line b/c rules are thrown out if selector is invalid.
   IE11 and old Edge versions don't support :focus-within. */
div.code-toolbar:focus-within > .toolbar {
  opacity: 1;
}

div.code-toolbar > .toolbar > .toolbar-item {
  display: inline-block;
}

div.code-toolbar > .toolbar > .toolbar-item > a {
  cursor: pointer;
}

div.code-toolbar > .toolbar > .toolbar-item > button {
  background: none;
  border: 0;
  color: inherit;
  font: inherit;
  line-height: normal;
  overflow: visible;
  padding: 0;
  -webkit-user-select: none; /* for button */
  -moz-user-select: none;
  -ms-user-select: none;
}

div.code-toolbar > .toolbar > .toolbar-item > a,
div.code-toolbar > .toolbar > .toolbar-item > button,
div.code-toolbar > .toolbar > .toolbar-item > span {
  color: inherit;
  font-size: .8em;
  padding: 4px .5em;
  background: #f5f2f0;
  background: rgba(224, 224, 224, 0.4);
  box-shadow: 0 2px 0 0 rgba(0,0,0,0.2);
  border-radius: .5em;
}

div.code-toolbar > .toolbar > .toolbar-item > a:hover,
div.code-toolbar > .toolbar > .toolbar-item > a:focus,
div.code-toolbar > .toolbar > .toolbar-item > button:hover,
div.code-toolbar > .toolbar > .toolbar-item > button:focus,
div.code-toolbar > .toolbar > .toolbar-item > span:hover,
div.code-toolbar > .toolbar > .toolbar-item > span:focus {
  color: inherit;
  text-decoration: none;
}
</style><script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script><script>!function(){if("undefined"!=typeof Prism&&"undefined"!=typeof document){var e=[],t={},n=function(){};Prism.plugins.toolbar={};var a=Prism.plugins.toolbar.registerButton=function(n,a){var r;r="function"==typeof a?a:function(e){var t;return"function"==typeof a.onClick?((t=document.createElement("button")).type="button",t.addEventListener("click",(function(){a.onClick.call(this,e)}))):"string"==typeof a.url?(t=document.createElement("a")).href=a.url:t=document.createElement("span"),a.className&&t.classList.add(a.className),t.textContent=a.text,t},n in t?console.warn('There is a button with the key "'+n+'" registered already.'):e.push(t[n]=r)},r=Prism.plugins.toolbar.hook=function(a){var r=a.element.parentNode;var l=a.element.classList;if(l.contains('language-mermaid') || l.contains('language-echarts') || l.contains('language-plantuml')){return;} if(r&&/pre/i.test(r.nodeName)&&!r.parentNode.classList.contains("code-toolbar")){var o=document.createElement("div");o.classList.add("code-toolbar"),r.parentNode.insertBefore(o,r),o.appendChild(r);var i=document.createElement("div");i.classList.add("toolbar");var l=e,d=function(e){for(;e;){var t=e.getAttribute("data-toolbar-order");if(null!=t)return(t=t.trim()).length?t.split(/\s*,\s*/g):[];e=e.parentElement}}(a.element);d&&(l=d.map((function(e){return t[e]||n}))),l.forEach((function(e){var t=e(a);if(t){var n=document.createElement("div");n.classList.add("toolbar-item"),n.appendChild(t),i.appendChild(n)}})),o.appendChild(i)}};a("label",(function(e){var t=e.element.parentNode;if(t&&/pre/i.test(t.nodeName)&&t.hasAttribute("data-label")){var n,a,r=t.getAttribute("data-label");try{a=document.querySelector("template#"+r)}catch(e){}return a?n=a.content:(t.hasAttribute("data-url")?(n=document.createElement("a")).href=t.getAttribute("data-url"):n=document.createElement("span"),n.textContent=r),n}})),Prism.hooks.add("complete",r)}}();</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/toolbar/prism-toolbar.min.css"><script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script><style>div.code-toolbar > .toolbar > .toolbar-item > a, div.code-toolbar > .toolbar > .toolbar-item > button, div.code-toolbar > .toolbar > .toolbar-item > span {padding: 4px .5em; background: #f5f2f0; background: rgba(224, 224, 224, 0.4);}</style>

<style type="text/css">
figure{margin: 0;padding: 0;}
figcaption{text-align:center;}

/* PrismJS 1.14.0
 http://prismjs.com/download.html#themes=prism&languages=markup+css+clike+javascript */
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
    color: black;
    background: none;
    text-shadow: 0 1px white;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
    
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
    
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
    text-shadow: none;
    background:#b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
    text-shadow: none;
    background: #b3d4fc;
}

@media print {
    code[class*="language-"],
    pre[class*="language-"] {
        text-shadow: none;
    }
}

/* Code blocks */
pre[class*="language-"] {
    padding: 1em;
    margin: .5em 0;
    overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
    background: #F7F7F7;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
    padding: .1em;
    border-radius: .3em;
    white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
    color: slategray;
}

.token.punctuation {
    color: #999;
}

.namespace {
    opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
    color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
    color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
    color: #9a6e3a;
    background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
    color: #07a;
}

.token.function,
.token.class-name {
    color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
    color: #e90;
}

.token.important,
.token.bold {
    font-weight: bold;
}
.token.italic {
    font-style: italic;
}

.token.entity {
    cursor: help;
}


pre[class*="language-"].line-numbers {
    position: relative;
    padding-left: 3.8em;
    counter-reset: linenumber;
}

pre[class*="language-"].line-numbers > code {
    position: relative;
    white-space: inherit;
}

.line-numbers .line-numbers-rows {
    position: absolute;
    pointer-events: none;
    top: 0;
    font-size: 100%;
    left: -3.8em;
    width: 3em; /* works for line-numbers below 1000 lines */
    letter-spacing: -1px;
    border-right: 1px solid #999;

    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;

}

    .line-numbers-rows > span {
        pointer-events: none;
        display: block;
        counter-increment: linenumber;
    }

        .line-numbers-rows > span:before {
            content: counter(linenumber);
            color: #999;
            display: block;
            padding-right: 0.8em;
            text-align: right;
        }

</style>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>



  </body>
</html>
