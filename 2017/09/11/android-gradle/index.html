<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Android," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Android GradleAndroid项目使用 Gradle 作为构建框架，Gradle 又是以Groovy为脚本语言。所以学习Gradle之前需要先熟悉Groovy脚本语言。
Groovy是基于Java语言的脚本语言，所以它的语法和Java非常相似，但是具有比java更好的灵活性。下面就列举一些和Java的主要区别。
Android Gradle 的 Project 和 Tasks这个Gra">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Gradle使用总结">
<meta property="og:url" content="http://adolph.cc/2017/09/11/android-gradle/index.html">
<meta property="og:site_name" content="Magic">
<meta property="og:description" content="Android GradleAndroid项目使用 Gradle 作为构建框架，Gradle 又是以Groovy为脚本语言。所以学习Gradle之前需要先熟悉Groovy脚本语言。
Groovy是基于Java语言的脚本语言，所以它的语法和Java非常相似，但是具有比java更好的灵活性。下面就列举一些和Java的主要区别。
Android Gradle 的 Project 和 Tasks这个Gra">
<meta property="og:image" content="http://ohtrrgyyd.bkt.clouddn.com/20171028150920575828.png">
<meta property="og:image" content="http://ohtrrgyyd.bkt.clouddn.com/20171028150920589712600.png">
<meta property="og:updated_time" content="2017-10-28T17:09:37.440Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Gradle使用总结">
<meta name="twitter:description" content="Android GradleAndroid项目使用 Gradle 作为构建框架，Gradle 又是以Groovy为脚本语言。所以学习Gradle之前需要先熟悉Groovy脚本语言。
Groovy是基于Java语言的脚本语言，所以它的语法和Java非常相似，但是具有比java更好的灵活性。下面就列举一些和Java的主要区别。
Android Gradle 的 Project 和 Tasks这个Gra">
<meta name="twitter:image" content="http://ohtrrgyyd.bkt.clouddn.com/20171028150920575828.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":0,"b2t":true,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://adolph.cc/2017/09/11/android-gradle/"/>





  <title> Android Gradle使用总结 | Magic </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta custom-logo">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Magic</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://adolph.cc/2017/09/11/android-gradle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="MagicalRice">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ohtrrgyyd.bkt.clouddn.com/037c5bde749f737e107c8fb8e9321c9d.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Magic">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Android Gradle使用总结
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-11T22:13:00+08:00">
                2017-09-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv">本文总阅读量
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Android-Gradle"><a href="#Android-Gradle" class="headerlink" title="Android Gradle"></a>Android Gradle</h1><p>Android项目使用 Gradle 作为构建框架，Gradle 又是以Groovy为脚本语言。所以学习Gradle之前需要先熟悉Groovy脚本语言。</p>
<p>Groovy是基于Java语言的脚本语言，所以它的语法和Java非常相似，但是具有比java更好的灵活性。下面就列举一些和Java的主要区别。</p>
<h1 id="Android-Gradle-的-Project-和-Tasks"><a href="#Android-Gradle-的-Project-和-Tasks" class="headerlink" title="Android Gradle 的 Project 和 Tasks"></a>Android Gradle 的 Project 和 Tasks</h1><p>这个Gradle中最重要的两个概念。每次构建（build）至少由一个project构成，一个project 由一到多个task构成。项目结构中的每个build.gradle文件代表一个project，在这编译脚本文件中可以定义一系列的task；task 本质上又是由一组被顺序执行的Action`对象构成，Action其实是一段代码块，类似于Java中的方法。</p>
<h1 id="Android-Gradle-构建生命周期"><a href="#Android-Gradle-构建生命周期" class="headerlink" title="Android Gradle 构建生命周期"></a>Android Gradle 构建生命周期</h1><p>每次构建的执行本质上执行一系列的Task。某些Task可能依赖其他Task。哪些没有依赖的Task总会被最先执行，而且每个Task只会被执行一遍。每次构建的依赖关系是在构建的配置阶段确定的。每次构建分为3个阶段：</p>
<ul>
<li>Initialization: 初始化阶段</li>
</ul>
<p>这是创建Project阶段，构建工具根据每个build.gradle文件创建出一个Project实例。初始化阶段会执行项目根目录下的settings.gradle文件，来分析哪些项目参与构建。</p>
<p>所以这个文件里面的内容经常是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">include &apos;:app&apos;</div><div class="line">include &apos;:libraries:someProject&apos;</div></pre></td></tr></table></figure>
<p>这是告诉Gradle这些项目需要编译，所以我们引入一些开源的项目的时候，需要在这里填上对应的项目名称，来告诉Gradle这些项目需要参与构建。</p>
<ul>
<li>Configuration:配置阶段</li>
</ul>
<p>这个阶段，通过执行构建脚本来为每个project创建并配置Task。配置阶段会去加载所有参与构建的项目的build.gradle文件，会将每个build.gradle文件实例化为一个Gradle的project对象。然后分析project之间的依赖关系，下载依赖文件，分析project下的task之间的依赖关系。</p>
<ul>
<li>Execution:执行阶段</li>
</ul>
<p>这是Task真正被执行的阶段，Gradle会根据依赖关系决定哪些Task需要被执行，以及执行的先后顺序。<br>task是Gradle中的最小执行单元，我们所有的构建，编译，打包，debug，test等都是执行了某一个task，一个project可以有多个task，task之间可以互相依赖。例如我有两个task，taskA和taskB，指定taskA依赖taskB，然后执行taskA，这时会先去执行taskB，taskB执行完毕后在执行taskA。</p>
<p>说到这可能会有疑问，我翻遍了build.gradle也没看见一个task长啥样，有一种被欺骗的赶脚！</p>
<p>其实不是，你点击AndroidStudio右侧的一个Gradle按钮，会打开一个面板，内容差不多是这样的：</p>
<p><img src="http://ohtrrgyyd.bkt.clouddn.com/20171028150920575828.png" alt="20171028150920575828.png"></p>
<p>里面的每一个条目都是一个task，那这些task是哪来的呢？</p>
<p>一个是根目录下的 build.gradle 中的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">	classpath &apos;com.android.tools.build:gradle:2.2.2&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>一个是 app 目录下的 build.gradle 中的</p>
<p><code>apply plugin: &#39;com.android.application&#39;</code></p>
<p>这两段代码决定的。也就是说，Gradle提供了一个框架，这个框架有一些运行的机制可以让你完成编译，但是至于怎么编译是由插件决定的。还好Google已经给我们写好了Android对应的Gradle工具，我们使用就可以了。</p>
<p>根目录下的build.gradle中dependencies {classpath ‘com.android.tools.build:gradle:2.2.2’}是Android Gradle编译插件的版本。</p>
<p>app目录下的build.gradle中的apply plugin: ‘com.android.application’是引入了Android的应用构建项目，还有com.android.library和com.android.test用来构建library和测试。</p>
<p>所有Android构建需要执行的task都封装在工具里，如果你有一些特殊需求的话，也可以自己写一些task。那么对于开发一个Android应用来说，最关键的部分就是如何来用AndroidGradle的插件了。</p>
<h1 id="认知Gradle-Wrapper"><a href="#认知Gradle-Wrapper" class="headerlink" title="认知Gradle Wrapper"></a>认知Gradle Wrapper</h1><p>Android Studio中默认会使用 Gradle Wrapper 而不是直接使用Gradle。命令也是使用gradlew而不是gradle。这是因为gradle针对特定的开发环境的构建脚本，新的gradle可能不能兼容旧版的构建环境。为了解决这个问题，使用Gradle Wrapper 来间接使用 gradle。相当于在外边包裹了一个中间层。对开发者来说，直接使用Gradlew 即可，不需要关心 gradle的版本变化。Gradle Wrapper 会负责下载合适的的gradle版本来构建项目。</p>
<h1 id="Android-三个文件重要的-gradle-文件"><a href="#Android-三个文件重要的-gradle-文件" class="headerlink" title="Android 三个文件重要的 gradle 文件"></a>Android 三个文件重要的 gradle 文件</h1><p>Gradle项目有3个重要的文件需要深入理解：项目根目录的 build.gradle , settings.gradle 和模块目录的 build.gradle 。</p>
<ul>
<li><p>1.settings.gradle 文件会在构建的 initialization 阶段被执行，它用于告诉构建系统哪些模块需要包含到构建过程中。对于单模块项目， settings.gradle 文件不是必需的。对于多模块项目，如果没有该文件，构建系统就不能知道该用到哪些模块。</p>
</li>
<li><p>2.项目根目录的 build.gradle 文件用来配置针对所有模块的一些属性。它默认包含2个代码块：buildscript{…}和allprojects{…}。前者用于配置构建脚本所用到的代码库和依赖关系，后者用于定义所有模块需要用到的一些公共属性。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">buildscript &#123;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">    dependencies &#123;</div><div class="line">        classpath &apos;com.android.tools.build:gradle:2.3.2&apos;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">allprojects &#123;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">task clean(type: Delete) &#123;</div><div class="line">    delete rootProject.buildDir</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>buildscript：定义了 Android 编译工具的类路径。repositories中, jCenter是一个著名的 Maven 仓库。</p>
<p>allprojects:中定义的属性会被应用到所有 moudle 中，但是为了保证每个项目的独立性，我们一般不会在这里面操作太多共有的东西。</p>
<ul>
<li>3.模块级配置文件 build.gradle 针对每个moudle 的配置，如果这里的定义的选项和顶层 build.gradle定义的相同。它有3个重要的代码块：plugin，android 和 dependencies。</li>
</ul>
<h1 id="定制项目属性（project-properties"><a href="#定制项目属性（project-properties" class="headerlink" title="定制项目属性（project properties)"></a>定制项目属性（project properties)</h1><p>在项目根目录的build.gradle配置文件中，我们可以定制适用于所有模块的属性，通过ext 代码块来实现。如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ext &#123;</div><div class="line">    compileSdkVersion = 22</div><div class="line">    buildToolsVersion = &quot;22.0.1&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后我们可以在模块目录的build.gradle配置文件中引用这些属性,引用语法为rootProject.ext.{属性名}。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    compileSdkVersion rootProject.ext.compileSdkVersion</div><div class="line">    buildToolsVersion rootProject.ext.buildToolsVersion</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Android-studio-gradle-Task"><a href="#Android-studio-gradle-Task" class="headerlink" title="Android studio gradle Task"></a>Android studio gradle Task</h1><p><img src="http://ohtrrgyyd.bkt.clouddn.com/20171028150920589712600.png" alt="20171028150920589712600.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">//构建</div><div class="line">gradlew app:clean    //移除所有的编译输出文件，比如apk</div><div class="line"></div><div class="line">gradlew app:build   //构建 app module ，构建任务，相当于同时执行了check任务和assemble任务</div><div class="line"></div><div class="line">//检测</div><div class="line">gradlew app:check   //执行lint检测编译。</div><div class="line"></div><div class="line">//打包</div><div class="line">gradlew app:assemble //可以编译出release包和debug包，可以使用gradlew assembleRelease或者gradlew assembleDebug来单独编译一种包</div><div class="line"></div><div class="line">gradlew app:assembleRelease  //app module 打 release 包</div><div class="line"></div><div class="line">gradlew app:assembleDebug  //app module 打 debug 包</div><div class="line"></div><div class="line">//安装，卸载</div><div class="line"></div><div class="line">gradlew app:installDebug  //安装 app 的 debug 包到手机上</div><div class="line"></div><div class="line">gradlew app:uninstallDebug  //卸载手机上 app 的 debug 包</div><div class="line"></div><div class="line">gradlew app:uninstallRelease  //卸载手机上 app 的 release 包</div><div class="line"></div><div class="line">gradlew app:uninstallAll  //卸载手机上所有 app 的包</div></pre></td></tr></table></figure>
<p>这些都是基本的命令，在实际项目中会根据不同的配置，会对这些task 设置不同的依赖。比如 默认的 assmeble 会依赖 assembleDebug 和assembleRelease，如果直接执行assmeble，最后会编译debug，和release 的所有版本出来。如果我们只需要编译debug 版本，我们可以运行assembleDebug。</p>
<p>除此之外还有一些常用的新增的其他命令，比如 install命令，会将编译后的apk 安装到连接的设备。</p>
<h1 id="lint-检测"><a href="#lint-检测" class="headerlink" title="lint 检测"></a>lint 检测</h1><ul>
<li>忽略编译器的 lint 检查</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line"></div><div class="line">  lintOptions &#123;</div><div class="line">      abortOnError false</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="buildTypes-定义了编译类型"><a href="#buildTypes-定义了编译类型" class="headerlink" title="buildTypes 定义了编译类型"></a>buildTypes 定义了编译类型</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">android&#123;</div><div class="line"></div><div class="line">  buildTypes &#123;</div><div class="line">       release &#123;</div><div class="line">           minifyEnabled true  //打开混淆</div><div class="line">           proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</div><div class="line">       &#125;</div><div class="line">		debug &#123;</div><div class="line">           minifyEnabled false //关闭混淆</div><div class="line">           proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="productFlavors-多渠道打包"><a href="#productFlavors-多渠道打包" class="headerlink" title="productFlavors 多渠道打包"></a>productFlavors 多渠道打包</h1><p>AndroidManifest.xml 里设置动态渠道变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;meta-data</div><div class="line">    android:name=&quot;UMENG_CHANNEL&quot;</div><div class="line">    android:value=&quot;$&#123;UMENG_CHANNEL_VALUE&#125;&quot; /&gt;</div><div class="line">```    </div><div class="line"></div><div class="line">在 build.gradle 设置 productFlavors , 这里假定我们需要打包的渠道为酷安市场、360、小米、百度、豌豆荚。</div></pre></td></tr></table></figure>
<p>android {  </p>
<pre><code>productFlavors {
    kuan {
        manifestPlaceholders = [UMENG_CHANNEL_VALUE: &quot;kuan&quot;]
    }
    xiaomi {
        manifestPlaceholders = [UMENG_CHANNEL_VALUE: &quot;xiaomi&quot;]
    }
    qh360 {
        manifestPlaceholders = [UMENG_CHANNEL_VALUE: &quot;qh360&quot;]
    }
    baidu {
        manifestPlaceholders = [UMENG_CHANNEL_VALUE: &quot;baidu&quot;]
    }
    wandoujia {
        manifestPlaceholders = [UMENG_CHANNEL_VALUE: &quot;wandoujia&quot;]
    }
} 
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">或者批量修改</div></pre></td></tr></table></figure></p>
<p>android {  </p>
<pre><code>productFlavors {
    kuan {}
    xiaomi {}
    qh360 {}
    baidu {}
    wandoujia {}
}  

productFlavors.all { 
    flavor -&gt; flavor.manifestPlaceholders = [UMENG_CHANNEL_VALUE: name] 
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">这样在打包的时候就可以选择渠道了</div><div class="line"></div><div class="line">![20171028150920602392842.png](http://ohtrrgyyd.bkt.clouddn.com/20171028150920602392842.png)</div><div class="line"></div><div class="line">或者用命令打包 ，比如：</div></pre></td></tr></table></figure></p>
<p>gradlew assembleWandoujiaRelease  //豌豆荚 release 包</p>
<p>gradlew assembleWandoujiaDebug //豌豆荚 debug 包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># 多渠道设置包名</div><div class="line"></div><div class="line">有时候我们需要分渠道设置 applicationId 、友盟的 appkey 、友盟渠道号。</div></pre></td></tr></table></figure></p>
<p>productFlavors {<br>    google {<br>        applicationId “com.wifi.cool”<br>        manifestPlaceholders = [<br>            UMENG_APPKEY_VALUE : “456789456789”,<br>            UMENG_CHANNEL_VALUE: “google”,<br>        ]<br>    }</p>
<pre><code>baidu{
    applicationId &apos;com.wifi.hacker&apos;
    manifestPlaceholders = [
    UMENG_APPKEY_VALUE     : &quot;123456789789&quot;,
    UMENG_CHANNEL_VALUE    : &quot;baidu&quot;,          
    ]
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># Signing 签名</div><div class="line"></div><div class="line">在 android 标签下添加 signingConfigs 标签，如下：</div></pre></td></tr></table></figure></p>
<p>android {<br>    signingConfigs {<br>        config {<br>           keyAlias ‘yiba’<br>           keyPassword ‘123456’<br>           storeFile file(‘C:/work/Key.jks’)<br>           storePassword ‘1234567’<br>       }<br>   }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">可以在 release 和 debug 包中定义签名，如下：</div></pre></td></tr></table></figure></p>
<p>android {<br>    signingConfigs {<br>        config {<br>            keyAlias ‘yiba’<br>            keyPassword ‘123456’<br>            storeFile file(‘C:/work/Key.jks’)<br>            storePassword ‘1234567’<br>        }<br>    }</p>
<pre><code>buildTypes {
    release {
        minifyEnabled false
        proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;
        signingConfig signingConfigs.config
    }
    debug {
        minifyEnabled false
        proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;
        signingConfig signingConfigs.config
    }
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># 依赖管理</div><div class="line"></div><div class="line">## 依赖 jcenter 包</div><div class="line"></div><div class="line">每个库名称包含三个元素：组名:库名称:版本号</div><div class="line"></div><div class="line">`compile &apos;com.android.support:appcompat-v7:25.0.0&apos;`</div><div class="line"></div><div class="line">## 依赖本地 module</div><div class="line"></div><div class="line">`compile project(&apos;:YibaAnalytics&apos;)`</div><div class="line"></div><div class="line">## 依赖 jar 包</div><div class="line"></div><div class="line">- 把 jar 包放在 libs 目录下</div><div class="line">- 在 build.gradle 中添加依赖</div></pre></td></tr></table></figure></p>
<p>dependencies {<br>   compile files(‘libs/YibaAnalytics5.jar’)<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">![20171028150920619455522.png](http://ohtrrgyyd.bkt.clouddn.com/20171028150920619455522.png)</div><div class="line"></div><div class="line">## 依赖 aar 包</div><div class="line"></div><div class="line">- 把 aar 包放到 libs 目录下</div><div class="line">- 在 build.gradle 中添加依赖</div></pre></td></tr></table></figure></p>
<p>repositories {<br>    flatDir {<br>        dirs ‘libs’<br>    }<br>}</p>
<p>dependencies {<br>    compile(name:’YibaAnalytics-release’, ext:’aar’)<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">如图所示：</div><div class="line"></div><div class="line">![20171028150920622394032.png](http://ohtrrgyyd.bkt.clouddn.com/20171028150920622394032.png)</div><div class="line"></div><div class="line">- 自定义依赖包目录</div><div class="line"></div><div class="line">当我们的 aar 包需要被多个 module 依赖时，我们就不能把 aar 包放在单一的 module 中，我们可以在项目的根目录创建一个目录，比如叫 aar 目录，然后把我们的 aar 包放进去，如图所示：</div><div class="line"></div><div class="line">![20171028150920623519197.png](http://ohtrrgyyd.bkt.clouddn.com/20171028150920623519197.png)</div><div class="line"></div><div class="line">在项目的根目录的 build.gradle 的 allprojects 标签下的 repositories 添加 ：</div></pre></td></tr></table></figure></p>
<p> flatDir {<br>     dirs ‘../aar’<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">../aar 表示根目录下的 aar 文件夹。</div><div class="line"></div><div class="line">如图所示：</div><div class="line"></div><div class="line">![20171028150920625348073.png](http://ohtrrgyyd.bkt.clouddn.com/20171028150920625348073.png)</div><div class="line"></div><div class="line">然后就可以添加依赖了，如下所示：</div><div class="line"></div><div class="line">`compile(name:&apos;YibaAnalytics-release&apos;, ext:&apos;aar&apos;)`</div><div class="line"></div><div class="line">## 依赖配置</div><div class="line"></div><div class="line">有些时候，你可能需要和sdk协调工作。为了能顺利编译你的代码，你需要添加SDK到你的编译环境。你不需要将sdk包含在你的APK中，因为它早已经存在于设备中，所以配置来啦，我们会有5个不同的配置：</div><div class="line"></div><div class="line">- compile</div><div class="line">- apk</div><div class="line">- provided</div><div class="line">- testCompile</div><div class="line">- androidTestCompile</div><div class="line"></div><div class="line">compile是默认的那个，其含义是包含所有的依赖包，即在APK里，compile的依赖会存在。</div><div class="line"></div><div class="line">apk的意思是apk中存在，但是不会加入编译中，这个貌似用的比较少。</div><div class="line"></div><div class="line">provided的意思是提供编译支持，但是不会写入apk。</div><div class="line"></div><div class="line">## 排除依赖兼容包</div><div class="line"></div><div class="line">有时候我们在引入依赖包的时候，会额外的引入 v7, v4 的包，对我们的项目造成额外的负担，我们需要把这个兼容包排除，可以使用 exclude 就能做到。</div></pre></td></tr></table></figure></p>
<p>compile(‘com.google.firebase:firebase-ads:11.0.4’, {<br>      exclude group: ‘com.android.support’   //排除v7 , v4 包<br>})<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># native包（so包）</div><div class="line"></div><div class="line">用c或者c++写的library会被叫做so包，Android插件默认情况下支持native包，你需要把.so文件放在对应的文件夹中：</div><div class="line"></div><div class="line">![20171028150920630815374.png](http://ohtrrgyyd.bkt.clouddn.com/20171028150920630815374.png)</div><div class="line"></div><div class="line">**注意**</div><div class="line"></div><div class="line">jniLibs 目录应该和 Java 目录在同一级</div><div class="line"></div><div class="line"># defaultConfig 详解</div><div class="line"></div><div class="line">defaultConfig 对应的是 ProductFlavor 类。</div><div class="line"></div><div class="line"># resConfigs ： 过滤语言</div><div class="line"></div><div class="line">如果你的app中仅支持1,2种语言，但是可能引用的lib库包含多种其他语言的strings资源，这个时候我们可以通过resConfig指定我们需要的strings资源。</div></pre></td></tr></table></figure></p>
<p>android {</p>
<pre><code>defaultConfig {
    applicationId &quot;com.yiba.sharewe.lite.activity&quot;
    minSdkVersion 14
    targetSdkVersion 24
    versionCode 46
    versionName &quot;1.74&quot;
    resConfigs &apos;en&apos;, &apos;zh-rCN&apos; ,&apos;es&apos;  //本次打包，只把 en(英文)、zh-rCN(中文简体)、es（西班牙语）打进保内，其他语言忽略
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># resConfigs ： 过滤 drawable文件夹的资源</div><div class="line"></div><div class="line">一般情况下，我们打完包，res 下面的资源如图所示：</div><div class="line"></div><div class="line">![20171028150920635182429.png](http://ohtrrgyyd.bkt.clouddn.com/20171028150920635182429.png)</div><div class="line"></div><div class="line">现在加上资源过滤规则：</div></pre></td></tr></table></figure></p>
<p>android {<br>    defaultConfig {<br>        applicationId “com.wifi.analytics”<br>        minSdkVersion 9<br>        targetSdkVersion 25<br>        versionCode 1<br>        versionName “1.0”<br>        resConfigs “hdpi”  //打包的时候只保留 drawable-xhdpi 文件夹里面的资源<br>    }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">这次我们打包效果如下：</div><div class="line"></div><div class="line">![20171028150920637414691.png](http://ohtrrgyyd.bkt.clouddn.com/20171028150920637414691.png)</div><div class="line"></div><div class="line"># buildTypes 详解</div><div class="line"></div><div class="line">[官方文档](http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.BuildType.html)</div><div class="line"></div><div class="line">buildTypes&#123;&#125;对应的是 BuildType 类</div><div class="line"></div><div class="line">**继承关系**</div><div class="line"></div><div class="line">BuildType 继承 DefaultBuildType ； DefaultBuildType 继承 BaseConfigImpl ；</div></pre></td></tr></table></figure></p>
<p>BaseConfigImpl<br>    — DefaultBuildType<br>          — BuildType<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">**buildTypes的属性**：</div></pre></td></tr></table></figure></p>
<p>name：build type的名字</p>
<p>applicationIdSuffix：应用id后缀</p>
<p>versionNameSuffix：版本名称后缀</p>
<p>debuggable：是否生成一个debug的apk</p>
<p>minifyEnabled：是否混淆</p>
<p>proguardFiles：混淆文件</p>
<p>signingConfig：签名配置</p>
<p>manifestPlaceholders：清单占位符</p>
<p>shrinkResources：是否去除未利用的资源，默认false，表示不去除。</p>
<p>zipAlignEnable：是否使用zipalign工具压缩。</p>
<p>multiDexEnabled：是否拆成多个Dex</p>
<p>multiDexKeepFile：指定文本文件编译进主Dex文件中</p>
<p>multiDexKeepProguard：指定混淆文件编译进主Dex文件中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">**buildType的方法**：</div></pre></td></tr></table></figure></p>
<p>1.buildConfigField(type,name,value)：添加一个变量生成BuildConfig类。</p>
<p>2.consumeProguardFile(proguardFile)：添加一个混淆文件进arr包。</p>
<p>3.consumeProguardFile(proguardFiles)：添加混淆文件进arr包。</p>
<p>4.externalNativeBuild(action)：配置本地的build选项。</p>
<p>5.initWith：复制这个build类型的所有属性。</p>
<p>6.proguardFile(proguardFile)：添加一个新的混淆配置文件。</p>
<p>7.proguradFiles(files):添加新的混淆文件</p>
<p>8.resValue(type,name,value)：添加一个新的生成资源</p>
<p>9.setProguardFiles(proguardFileIterable):设置一个混淆配置文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># initWith ：复制属性</div></pre></td></tr></table></figure></p>
<p>android {<br>    compileSdkVersion 25<br>    buildToolsVersion “25.0.2”<br>    defaultConfig {<br>        applicationId “com.wifi.analytics”<br>        minSdkVersion 9<br>        targetSdkVersion 25<br>        versionCode 1<br>        versionName “1.0”<br>    }<br>    buildTypes {<br>        release {<br>            minifyEnabled false<br>            proguardFiles getDefaultProguardFile(‘proguard-android.txt’), ‘proguard-rules.pro’<br>        }<br>        debug {<br>            minifyEnabled false<br>            proguardFiles getDefaultProguardFile(‘proguard-android.txt’), ‘proguard-rules.pro’<br>        }</p>
<pre><code>    myType {
        initWith debug  //完全复制 debug 的所有属性‘
        minifyEnabled true //自定义打开混淆
    }
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># applicationIdSuffix 、versionNameSuffix ：添加后缀</div></pre></td></tr></table></figure></p>
<p>android {<br>    compileSdkVersion 25<br>    buildToolsVersion “25.0.2”<br>    defaultConfig {<br>        applicationId “com.wifi.analytics”<br>        minSdkVersion 9<br>        targetSdkVersion 25<br>        versionCode 1<br>        versionName “1.0”<br>    }<br>    buildTypes {<br>        release {<br>            minifyEnabled false<br>            proguardFiles getDefaultProguardFile(‘proguard-android.txt’), ‘proguard-rules.pro’<br>        }<br>        debug {<br>            minifyEnabled false<br>            proguardFiles getDefaultProguardFile(‘proguard-android.txt’), ‘proguard-rules.pro’<br>            applicationIdSuffix “zhao”  //applicationId 追加后缀名 zhao<br>            versionNameSuffix “debug”  //versionName 追加后缀名 debug1.0<br>        }<br>    }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">效果图，如下：</div><div class="line"></div><div class="line">![20171029150920649886369.png](http://ohtrrgyyd.bkt.clouddn.com/20171029150920649886369.png)</div><div class="line"></div><div class="line"># buildConfigField： 自定义属性</div><div class="line"></div><div class="line">在 build.gradle 文件中定义 buildConfigField 属性</div></pre></td></tr></table></figure></p>
<p>android {</p>
<pre><code>buildTypes {
    release {
        minifyEnabled false
        proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;
        buildConfigField &quot;String&quot;, &quot;API_ENV&quot;, &quot;\&quot;http://yiba.com\&quot;&quot;  //自定义String属性
    }
    debug {
        minifyEnabled false
        proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;
        buildConfigField &quot;String&quot;, &quot;API_ENV&quot;, &quot;\&quot;http://yiba.com\&quot;&quot;  //自定义String属性
    }
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">然后点击同步按钮，然后就可以在 build 目录看到 debug 和 release 信息。</div><div class="line"></div><div class="line">debug 环境下的 BuildConfig 如下： </div><div class="line"></div><div class="line">![20171029150920652322417.png](http://ohtrrgyyd.bkt.clouddn.com/20171029150920652322417.png)</div><div class="line"></div><div class="line">release 环境下的 BuildConfig 如下：</div><div class="line"></div><div class="line">![20171029150920653292275.png](http://ohtrrgyyd.bkt.clouddn.com/20171029150920653292275.png)</div><div class="line"></div><div class="line">当然我们也可以在代码中获取自定义的值：</div></pre></td></tr></table></figure></p>
<p>//获取变量值<br>String API = BuildConfig.API_ENV ;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">上面演示了自定义 String 变量，也可以 自定义 int 、boolean</div></pre></td></tr></table></figure></p>
<p>android {</p>
<pre><code>buildTypes {
    debug {
        minifyEnabled false
        proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;
        buildConfigField &quot;String&quot;, &quot;API_ENV&quot;, &quot;\&quot;http://www.baidu.com\&quot;&quot; //自定义 String 值
        buildConfigField &quot;Boolean&quot;, &quot;openLog&quot;, &quot;true&quot; //自定义 boolean 值
        buildConfigField &quot;int&quot;, &quot;age&quot;, &quot;10&quot;   //自定义 int 值
    }
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># Gradle 实现差异化构建</div><div class="line"></div><div class="line">## 情景1</div><div class="line"></div><div class="line">LeakCanary 是 square 公司出品的一个检测内存泄漏的开源库。</div><div class="line"></div><div class="line">GitHub ： [https://github.com/square/leakcanary](https://github.com/square/leakcanary)</div><div class="line"></div><div class="line">我们一般这样集成</div></pre></td></tr></table></figure></p>
<p>dependencies {<br>    compile ‘com.squareup.leakcanary:leakcanary-android:1.5.2’<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">然后我们在 Application 类中初始化：</div></pre></td></tr></table></figure></p>
<p>public class MyApplication extends Application {</p>
<pre><code>@Override
public void onCreate() {
    super.onCreate();

    LeakCanary.install(this);
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">但是这样集成有一个弊端，就是 debug 和 release 包都会把 LeakCanary 的源码打进去，如果我们在 release 包中不把 LeakCanary 源码打进去，怎么办？ 还好 LeakCanary 给我们提供了一个方法，方法如下：</div></pre></td></tr></table></figure></p>
<p>dependencies {</p>
<p> //打 debug 包<br> debugCompile ‘com.squareup.leakcanary:leakcanary-android:1.5.1’</p>
<p> //打 release 包<br> releaseCompile ‘com.squareup.leakcanary:leakcanary-android-no-op:1.5.1’</p>
<p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">leakcanary-android-no-op 是一个空壳，里面有2个空类，所以就可以避免把 LeakCanary 源码打进 release 包。但是这种方式有个缺陷，如果一些开源库没有提供 releaseCompile 库，那我们改怎么办了？下面的情景2 就会讲到解决方案。</div><div class="line"></div><div class="line">## 情景2</div><div class="line"></div><div class="line">Stetho 是 Faceboo k开源的Andorid调试工具。当你的应用集成Stetho时，开发者可以访问Chrome，在Chrome Developer Tools中查看应用布局，网络请求，sqlite，preference 等等。</div><div class="line"></div><div class="line">官网：[http://facebook.github.io/stetho/](http://facebook.github.io/stetho/)</div><div class="line"></div><div class="line">从官网可以看到 stetho 没有提供 releaseCompile 包 ， 情景1 的方案就不能用了。新的思路集成方案如下：</div></pre></td></tr></table></figure></p>
<p>dependencies {<br>    debugCompile ‘com.facebook.stetho:stetho:1.5.0’<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">在 src 目录下创建 debug 目录、release 目录 ，然后分别在 debug 目录 和 release 目录 创建 java 目录 ， 在 java 目录中创建包名，比如： com.app , 如下图所示：</div><div class="line"></div><div class="line">![20171029150920663742117.png](http://ohtrrgyyd.bkt.clouddn.com/20171029150920663742117.png)</div><div class="line"></div><div class="line">debug 目录下创建 SDKManage 类 ，如下 ：</div></pre></td></tr></table></figure></p>
<p>public class SDKManager {</p>
<pre><code>public static void init(Context context) {
    //初始化 Stetho
    Stetho.initializeWithDefaults(context);
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">release 目录下创建 SDKManage 类 ，如下 ：</div></pre></td></tr></table></figure></p>
<p>public class SDKManager {</p>
<pre><code>public static void init(Context context) { 
    //这是一个空方法，目的是不引入 Stetho 源码
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">在住项目中的 MyApplication 类，并且完成 Stetho 的初始化，如下：</div></pre></td></tr></table></figure></p>
<p>public class MyApplication extends Application {</p>
<pre><code>@Override
public void onCreate() {
    super.onCreate();
    SDKManager.init(this);
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">这样我们便完成了简单的差异化构建, 打出来的 release 包就没有 Stetho 源码。</div><div class="line"></div><div class="line"># SourceSet</div><div class="line"></div><div class="line">## SourceSet 简介</div><div class="line"></div><div class="line">SourceSet 可以定义项目结构，也可以修改项目结构。Java插件默认实现了两个SourceSet，main 和 test。每个 SourceSet 都提供了一系列的属性，通过这些属性，可以定义该 SourceSet 所包含的源文件。比如，java.srcDirs，resources.srcDirs 。Java 插件中定义的其他任务，就根据 main 和 test 的这两个 SourceSet 的定义来寻找产品代码和测试代码等。</div><div class="line"></div><div class="line">## SourceSet 定义源码目录</div><div class="line"></div><div class="line">在 Android 项目中，我们可以在 src/main/java 目录新建 Java 文件，如下图所示：</div><div class="line"></div><div class="line">![20171029150920668425492.png](http://ohtrrgyyd.bkt.clouddn.com/20171029150920668425492.png)</div><div class="line"></div><div class="line">现在我们在 src 目录下，新建 test1 目录 ，发现不能在 test1 目录中新建 Java 文件，如下图所示：</div><div class="line"></div><div class="line">![20171029150920669347940.png](http://ohtrrgyyd.bkt.clouddn.com/20171029150920669347940.png)</div><div class="line"></div><div class="line">为什么在 test1 目录不能新建 Java 文件，因为 Gradle 中 SourceSet 默认定义的源码文件路径是src/main/java , 其他的文件下下面的源码我们自然无法访问。解决这个问题也很简单，我们需要在 SourceSet 中增加一个源码路径即可。如下所示：</div></pre></td></tr></table></figure></p>
<p>android {</p>
<pre><code>sourceSets {
    main {
        java {
            srcDir &apos;src/test1&apos; //指定源码目录
        }
    }
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">然后同步一下，就可以在 test1 目录中新建 Java 文件了。如下图所示：</div><div class="line"></div><div class="line">![20171029150920675182396.png](http://ohtrrgyyd.bkt.clouddn.com/20171029150920675182396.png)</div><div class="line"></div><div class="line">当然我们也可以同时指定多个源码目录，比如同时指定 test1 , test2 , test3 为源码目录。</div></pre></td></tr></table></figure></p>
<p>android {</p>
<pre><code>sourceSets {
    main {
        java {
            srcDir &apos;src/test1&apos; //指定 test1 为源码目录
            srcDir &apos;src/test2&apos; //指定 test2 为源码目录
            srcDir &apos;src/test3&apos; //指定 test3 为源码目录
        }
    }
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">或者 这样写 ：</div></pre></td></tr></table></figure></p>
<p>android {<br>    sourceSets {<br>        main {<br>            java.srcDirs( ‘src/test1’ , ‘src/test2’ ,’src/test3’ )<br>        }<br>    }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">效果如下图所示：</div><div class="line"></div><div class="line">![20171029150920677817619.png](http://ohtrrgyyd.bkt.clouddn.com/20171029150920677817619.png)</div><div class="line"></div><div class="line">## SourceSet 定义资源目录</div><div class="line"></div><div class="line">定义 test1 目录 Java 源代码路径、res 资源目录。目录结构如下图所示：</div><div class="line"></div><div class="line">![20171029150920679824349.png](http://ohtrrgyyd.bkt.clouddn.com/20171029150920679824349.png)</div></pre></td></tr></table></figure></p>
<p>android {</p>
<pre><code>sourceSets {
    main {
        java.srcDirs(&apos;src/test1/java&apos;)  //定义java 源代码
        res.srcDirs(&apos;src/test1/res&apos;)    //定义资源目录（layout , drawable,values）
    }
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## SourceSet 实现 layout 分包</div><div class="line"></div><div class="line">对于一个大项目来说，页面太多，布局文件就很多，有时在众多布局文件中找某个模块的布局文件，很是痛苦，为了解决这个问题，我们可以在创建多个 layout 目录，不同模块的布局文件放在不同的 layout 目录中，这样查找起来，就容易很多。</div><div class="line"></div><div class="line">例子：</div><div class="line"></div><div class="line">比如我们的项目中，有两个模块分别为：登录、注册。</div><div class="line"></div><div class="line">- 第一步：把项目中 layout 文件夹改名字为 layouts</div><div class="line"></div><div class="line">- 第二步：在 layouts 目录下，分别创建 login 、register 目录 。</div><div class="line"></div><div class="line">- 第三步：分别在 login 、register 目录下创建 layout 目录。注意这一步是必须的，否则会报错。</div><div class="line"></div><div class="line">- 第四步：把 登录布局文件、注册布局文件 分别放在 第三步创建的对应的 layout 目录下。</div><div class="line"></div><div class="line">效果图如下：</div><div class="line"></div><div class="line">![20171029150920685572520.png](http://ohtrrgyyd.bkt.clouddn.com/20171029150920685572520.png)</div><div class="line"></div><div class="line">SourceSet 实现如下：</div></pre></td></tr></table></figure></p>
<p>android {</p>
<pre><code>sourceSets {
    main {
        res.srcDirs &apos;src/main/res/layouts/login&apos;  //定义登录布局目录
        res.srcDirs &apos;src/main/res/layouts/register&apos;  //定义注册布局目录
    }
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## SourceSet 定义 AndroidManifest 文件</div><div class="line"></div><div class="line">指定 test1 目录下的 AndroidManifest 文件。项目结构如下图所示：</div><div class="line"></div><div class="line">![20171029150920687997782.png](http://ohtrrgyyd.bkt.clouddn.com/20171029150920687997782.png)</div><div class="line"></div><div class="line">代码如下：</div></pre></td></tr></table></figure></p>
<p>android {</p>
<pre><code>sourceSets {
    main {
        manifest.srcFile &apos;src/test1/AndroidManifest.xml&apos;
    }
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">在组件化开发中, 我们需要针对 debug 与 release 模式下, 指定不同的 Manifest 文件, 代码如下：</div></pre></td></tr></table></figure></p>
<p>android {<br>    def appDebug = false;</p>
<pre><code>buildTypes {
    release {
        minifyEnabled false
        proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;
        appDebug = false;
    }

    debug {
        minifyEnabled false
        proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;
        appDebug = false;
    }
}

sourceSets {
    main {
        if (appDebug) {
            manifest.srcFile &apos;src/test1/AndroidManifest.xml&apos;
        } else {
            manifest.srcFile &apos;src/main/AndroidManifest.xml&apos;
        }
    }
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## SourceSet 定义 assets 目录</div><div class="line"></div><div class="line">Android Studio 项目目录中，assets 默认目录如下：</div><div class="line"></div><div class="line">![20171029150920691136995.png](http://ohtrrgyyd.bkt.clouddn.com/20171029150920691136995.png)</div><div class="line"></div><div class="line">如何重新定义 assets 目录 。在项目的根目录下创建 assets 目录，如下图所示：</div><div class="line"></div><div class="line">![20171029150920691863996.png](http://ohtrrgyyd.bkt.clouddn.com/20171029150920691863996.png)</div><div class="line"></div><div class="line">sourceSets 定义代码如下：</div></pre></td></tr></table></figure></p>
<p>android {</p>
<pre><code>sourceSets {
    main {
        assets.srcDirs = [&apos;assets&apos;]
    }
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## SourceSet 定义其他资源</div></pre></td></tr></table></figure></p>
<p>android {</p>
<pre><code>sourceSets {
    main {
        jniLibs.srcDirs  //定义 jni 目录
        aidl.srcDirs  //定义 aidl 目录
    }
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># applicationVariants</div><div class="line"></div><div class="line">## 定义 versionName 、VersionCode</div><div class="line"></div><div class="line">在打包的时候分 debug 、release 版本 , 需要控制 versionName</div></pre></td></tr></table></figure></p>
<p>android {</p>
<pre><code> applicationVariants.all { variant -&gt;
    def flavor = variant.mergedFlavor
    def versionName = flavor.versionName
    if (variant.buildType.isDebuggable()) {
        versionName += &quot;_debug&quot;  //debug 名字
    } else {
        versionName += &quot;_release&quot; //release 名字
    }
    flavor.versionName = versionName
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## 定义 APK 包的名字</div></pre></td></tr></table></figure></p>
<p>apply plugin: ‘com.android.application’</p>
<p>android {</p>
<pre><code>defaultConfig {
    applicationId &quot;android.plugin&quot;
    minSdkVersion 14
    targetSdkVersion 25
    versionCode 1
    versionName &quot;1.0&quot;
}

buildTypes {
    release {
        minifyEnabled false
        proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;
    }
    debug {
        minifyEnabled false
        proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;
    }
}

//定义渠道
productFlavors {
    xiaomi {
        //小米
    }
    wandoujia {
        // 豌豆荚
    }
}

//打包命名
applicationVariants.all {
    variant -&gt;
        variant.outputs.each {
            output -&gt;

                //定义一个新的apk 名字。
                // 新名字 = app 名字+ 渠道号 + 构建类型 + 版本号 + 当前构建时间
                def apkName = &quot;appName_${variant.flavorName}_${buildType.name}_v${variant.versionName}_${getTime()}.apk&quot;;
                output.outputFile = new File(output.outputFile.parent, apkName);
        }
}
</code></pre><p>}</p>
<p>//获取当前时间<br>def getTime() {<br>    String today = new Date().format(‘YY年MM月dd日HH时mm分’)<br>    return today<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">效果图如下：</div><div class="line"></div><div class="line">![2017102915092069934597.png](http://ohtrrgyyd.bkt.clouddn.com/2017102915092069934597.png)</div><div class="line"></div><div class="line"># Task</div><div class="line"></div><div class="line">## 定义 task</div></pre></td></tr></table></figure></p>
<p>//定义任务1<br>task task1&lt;&lt;{<br>    println ‘task1’<br>}</p>
<p>//定义任务2<br>task task2&lt;&lt;{<br>    println ‘task2’<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## mustRunAfter 定义 task 执行顺序</div></pre></td></tr></table></figure></p>
<p>//task2 的执行顺讯在 task1 之后<br>task2.mustRunAfter task1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- 测试1 ： gradlew task1  </div><div class="line"></div><div class="line">效果如下：</div></pre></td></tr></table></figure></p>
<p>:app:task1<br>task1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- 测试2 ： gradlew task2  </div><div class="line"></div><div class="line">效果如下：</div></pre></td></tr></table></figure></p>
<p>:app:task2<br>task2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- 测试3 ： gradlew task1 task2  </div><div class="line"></div><div class="line">效果如下：</div></pre></td></tr></table></figure></p>
<p>:app:task1<br>task1<br>:app:task2<br>task2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- 测试4 ： gradlew task2 task1  </div><div class="line"></div><div class="line">效果如下：</div></pre></td></tr></table></figure></p>
<p>:app:task1<br>task1<br>:app:task2<br>task2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## 结论</div><div class="line"></div><div class="line">如果单独执行 task1 就只会执行 task1 的任务；单独执行 task2 就只会执行 task2 的任务； </div><div class="line">如果同时执行 task1、task2 , 一定会先执行 task1 , 等 task1 执行完后，就会执行 task2 内容。</div><div class="line"></div><div class="line">## 扩展</div><div class="line"></div><div class="line">上面 mustRunAfter 我们还有一种写法，如下图所示：</div><div class="line"></div><div class="line">`task2 &#123;&#125;.mustRunAfter task1`</div><div class="line"></div><div class="line">这个写法的效果和 mustRunAfter 是一样的，当然我们还可以在 花括号里面写一些任务，比如 ：</div></pre></td></tr></table></figure></p>
<p>task2 {<br>    println ‘我最先执行’<br>}.mustRunAfter task1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">下面做个测试，测试命令如下：</div><div class="line"></div><div class="line">`gradlew task2 task1`</div><div class="line"></div><div class="line">效果如下：</div></pre></td></tr></table></figure></p>
<p>我最先执行</p>
<p>:app:task1<br>task1<br>:app:task2<br>task2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## dependsOn 定义 task 依赖</div><div class="line"></div><div class="line">task2 任务依赖于 task1 ,执行 task2 就会先执行 task1</div><div class="line"></div><div class="line">`task2.dependsOn task1`</div><div class="line"></div><div class="line">测试：</div><div class="line"></div><div class="line">`gradlew task2`</div><div class="line"></div><div class="line">效果如下：</div></pre></td></tr></table></figure></p>
<p>:app:task1<br>task1<br>:app:task2<br>task2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># 常用 Gradlew 命令</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">- 1、gradlew -v : 查看版本号</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="Gradle-3-3"><a href="#Gradle-3-3" class="headerlink" title="Gradle 3.3"></a>Gradle 3.3</h2><p>Build time:   2017-01-03 15:31:04 UTC<br>Revision:     075893a3d0798c0c1f322899b41ceca82e4e134b</p>
<p>Groovy:       2.4.7<br>Ant:          Apache Ant(TM) version 1.9.6 compiled on June 29 2015<br>JVM:          1.8.0_112 (Oracle Corporation 25.112-b15)<br>OS:           Windows 10 10.0 amd64<br>```</p>
<ul>
<li>2、gradlew task ： 查看所有的 task</li>
</ul>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="http://www.jianshu.com/p/80e1f4a80d06#" target="_blank" rel="external">Android 利用Gradle实现差异化构建</a></p>
<p><a href="http://www.jianshu.com/p/011b8d63ba78" target="_blank" rel="external">杨海 Android目录结构</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/09/04/android-performance-optimize/" rel="next" title="Android App性能优化全方面解析">
                <i class="fa fa-chevron-left"></i> Android App性能优化全方面解析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/09/18/program-software-license/" rel="prev" title="程序员开源协议">
                程序员开源协议 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://ohtrrgyyd.bkt.clouddn.com/037c5bde749f737e107c8fb8e9321c9d.jpg"
               alt="MagicalRice" />
          <p class="site-author-name" itemprop="name">MagicalRice</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">138</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/adolphJane" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Android-Gradle"><span class="nav-number">1.</span> <span class="nav-text">Android Gradle</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Android-Gradle-的-Project-和-Tasks"><span class="nav-number">2.</span> <span class="nav-text">Android Gradle 的 Project 和 Tasks</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Android-Gradle-构建生命周期"><span class="nav-number">3.</span> <span class="nav-text">Android Gradle 构建生命周期</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#认知Gradle-Wrapper"><span class="nav-number">4.</span> <span class="nav-text">认知Gradle Wrapper</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Android-三个文件重要的-gradle-文件"><span class="nav-number">5.</span> <span class="nav-text">Android 三个文件重要的 gradle 文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#定制项目属性（project-properties"><span class="nav-number">6.</span> <span class="nav-text">定制项目属性（project properties)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Android-studio-gradle-Task"><span class="nav-number">7.</span> <span class="nav-text">Android studio gradle Task</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#lint-检测"><span class="nav-number">8.</span> <span class="nav-text">lint 检测</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#buildTypes-定义了编译类型"><span class="nav-number">9.</span> <span class="nav-text">buildTypes 定义了编译类型</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#productFlavors-多渠道打包"><span class="nav-number">10.</span> <span class="nav-text">productFlavors 多渠道打包</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Gradle-3-3"><span class="nav-number">10.1.</span> <span class="nav-text">Gradle 3.3</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考资料"><span class="nav-number">11.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">MagicalRice</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      本站访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>


        
      </div>
    </footer>

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  


  <script type="text/javascript" src="/js/src/particle.js" count="50" zindex="-2" opacity="1" color="0,104,183"></script>
</body>
</html>
