<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  Android项目从立项到上线 - MagicalRice的Blog
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="MagicalRice的Blog" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:adolph.cc ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="https://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; MagicalRice的Blog</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        
        <li><a target="self" href="index.html">Home</a></li>
        
        <li><a target="_self" href="archives.html">Archives</a></li>
        

    <li><label>Categories</label></li>

        
            <li><a href="Android.html">Android</a></li>
        
            <li><a href="%E9%9A%8F%E6%89%8B%E8%AE%B0.html">随手记</a></li>
        
            <li><a href="%E6%9C%8D%E5%8A%A1%E5%99%A8.html">服务器</a></li>
        
            <li><a href="C++.html">C++</a></li>
        
            <li><a href="UI.html">UI</a></li>
        
            <li><a href="MySQL.html">MySQL</a></li>
        
            <li><a href="%E7%AE%97%E6%B3%95.html">算法</a></li>
        
            <li><a href="Game.html">Game</a></li>
        
            <li><a href="Python.html">Python</a></li>
        
            <li><a href="%E8%B7%A8%E5%B9%B3%E5%8F%B0%E5%BC%80%E5%8F%91.html">跨平台开发</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
  $(function(){
    $('#menu_item_index').addClass('is_active');
  });
</script>
<div class="row">
  <div class="large-8 medium-8 columns">
      <div class="markdown-body article-wrap">
       <div class="article">
          
          <h1>Android项目从立项到上线</h1>
     
        <div class="read-more clearfix">
          <span class="date">2017/9/3</span>

          <span>posted in&nbsp;</span> 
          
              <span class="posted-in"><a href='Android.html'>Android</a></span>
           
         
          <span class="comments">
            

            
          </span>

        </div>
      </div><!-- article -->

      <div class="article-content">
      <p>最近在组建项目组从0开始开发项目，从立项到上线，有一些心得，包括项目规范、结构、优化、三方等，与大家分享，一起修仙！</p>

<p>接下来我会以自己写的两个项目为例，结合起来分析。代码已经上传github：</p>

<ul>
<li>Material Design风格项目 <a href="https://github.com/shuaijia/MaterialDesignProject">点击前往</a> 喜欢就给个star<sup>_^</sup></li>
<li>UI、Base、网络等封装库项目 <a href="https://github.com/shuaijia/JSBaseDemo">点击前往</a> 喜欢也给个star喽</li>
</ul>

<p>先上图来看看吧：</p>

<p><img src="http://ohtrrgyyd.bkt.clouddn.com/20171104150981004338352.png" alt="20171104150981004338352.png"/></p>

<p>项目采用<strong>MVP+Retrofit+RxJava+Gson+Glide+Material Design</strong>设计</p>

<p>同时也使用了<strong>EventBus</strong>事件总线、<strong>GreenDao</strong>数据库、<strong>SurfaceView+MediaPlayer视频播放器</strong>等主要技术。</p>

<p>ok！项目就简单介绍到这里，接下来开始我们的修仙之路。</p>

<p><img src="http://ohtrrgyyd.bkt.clouddn.com/20171104150981008811224.png" alt="20171104150981008811224.png"/></p>

<h2 id="toc_0">项目整体分析</h2>

<h3 id="toc_1">UI风格</h3>

<h4 id="toc_2">logo</h4>

<h4 id="toc_3">主题风格：</h4>

<ul>
<li>Material Design</li>
<li>仿ios</li>
<li>主界面–侧拉</li>
<li>主界面–仿微信 选项卡等</li>
</ul>

<h3 id="toc_4">技术方案</h3>

<h4 id="toc_5">整体分析项目，确定整体技术方案，之后的开发中按照技术方案执行，同时编写相关文档。</h4>

<ul>
<li>项目架构</li>
<li>网络框架</li>
<li>图片处理</li>
<li>数据处理/接口格式</li>
<li>三方使用：统计、推送、更新等</li>
</ul>

<h3 id="toc_6">可行性分析</h3>

<p>邀请项目经理、技术负责人、产品经理、后端开发、测试等共同分析技术方案的可行性，并相应调整技术方案。</p>

<h3 id="toc_7">工期</h3>

<p>根据项目需求和技术方案，给出开发时长；</p>

<p>根据工期要求，可适当调整技术方案。</p>

<h3 id="toc_8">测试用例</h3>

<p>测试人员开始整理、编写测试用例和项目标准文档；</p>

<p>个人觉得开发人员应该参与到测试工作中，这样方便自己对业务逻辑和功能分析全面，也帮助测试人员分析项目功能和技术，便于写出更加全面的测试用例。</p>

<h2 id="toc_9">开发规范</h2>

<p>其实Android、Ios、Server等各端开发人员，都应该有完整的、严格的开发规范，这里我只说一下Android端的开发规范：</p>

<p>以自己项目为例，涉及到以下几项：</p>

<ul>
<li>文档规范</li>
<li>资源命名规范</li>
<li>代码命名规范</li>
<li>代码注释规范</li>
<li>代码风格规范</li>
<li>服务器数据规范 等</li>
</ul>

<h3 id="toc_10">文档</h3>

<p>重要有以下几个文档：</p>

<ul>
<li>需求文档</li>
<li>产品原型图</li>
<li>完整UI图</li>
<li>接口文档</li>
<li>核心技术文档</li>
<li>重点逻辑文档</li>
<li>程序框架图</li>
<li>ER图、数据字典、类图等</li>
<li>测试文档</li>
</ul>

<h3 id="toc_11">资源文件命名规范</h3>

<p>名字全部小写，最好不用数字，全部英文，单词中间下划线隔开</p>

<h4 id="toc_12">drawable、anim等文件夹下</h4>

<p>名称结构为“技术点模块点空间类型_功能名”结构，技术点主要有：selector、translate、alpha、scale等，模块名主要有：login、pay、mine、setting等，控件类型主要有：button、textview、imageview、dialog等，功能名主要有：findpwd、request、back、next等。 </p>

<p><img src="http://ohtrrgyyd.bkt.clouddn.com/20171104150981042494432.png" alt="20171104150981042494432.png"/></p>

<h4 id="toc_13">drawable-xhdpi等图片资源</h4>

<p>名称为“技术点模块点功能名”结构，技术点主要有：activity、fragment、item、include等，模块点主要有：login、setting、mine、pay等，功能名主要有：head、title、back、sure等。 </p>

<p><img src="http://ohtrrgyyd.bkt.clouddn.com/20171104150981047164097.png" alt="20171104150981047164097.png"/></p>

<h4 id="toc_14">layout</h4>

<p>布局名称为“技术点模块功能名”结构，技术点主要有：activity、fragment、item、include等，模块主要有：home、lesson、mine、loginregist等，功能名主要有：login、title、setting、pay、bar等。 </p>

<p><img src="http://ohtrrgyyd.bkt.clouddn.com/20171104150981050013389.png" alt="20171104150981050013389.png"/></p>

<h4 id="toc_15">values</h4>

<p>布局名称为“技术点模块功能名”结构，技术点主要有：activity、fragment、item、include等，模块主要有：home、lesson、mine、loginregist等，功能名主要有：login、title、setting、pay、bar等。 </p>

<p><img src="http://ohtrrgyyd.bkt.clouddn.com/20171104150981053458526.png" alt="20171104150981053458526.png"/></p>

<h3 id="toc_16">代码命名规范</h3>

<h4 id="toc_17">包名</h4>

<p>包名为“根包名.技术点名.模块名”结构，<strong>全部小写</strong></p>

<p><img src="http://ohtrrgyyd.bkt.clouddn.com/20171104150981056272553.png" alt="20171104150981056272553.png"/></p>

<h4 id="toc_18">类名</h4>

<p>采用 <strong>大驼峰</strong> 命名法，单词直接拼接，所有单词首字母大写</p>

<p>类名为“业务模块名 执行操作名 技术点名”结构，业务模块名主要有：home、lession、net、login，pay等，操作名主要有：Get、Set、Request、Login等，技术点名主要有：Activity、Fragment、View、Adapter等。 </p>

<p><img src="http://ohtrrgyyd.bkt.clouddn.com/20171104150981070542458.png" alt="20171104150981070542458.png"/></p>

<h4 id="toc_19">普通变量</h4>

<p>采用 <strong>小驼峰</strong> 命名法，第一个单词首字母小写，其他单词首字母大写。</p>

<p>普通变量为“名字简写 类型 功能名”结构，名字简写有：js等，类型主要有：Int、Double、Boolean、String、Char等，功能名有：Login、Number、Content等。 </p>

<p><img src="http://ohtrrgyyd.bkt.clouddn.com/2017110515098119341868.png" alt="2017110515098119341868.png"/></p>

<h4 id="toc_20">常亮</h4>

<p>所有字母全部大写，中间下划线隔开</p>

<p>常量为“功能名_标识”结构，功能名主要有：LOGIN、REQUEST、PERSONINFO等，标识有SUCCESS、ERROR、URL等。</p>

<p><img src="http://ohtrrgyyd.bkt.clouddn.com/20171105150981196443079.png" alt="20171105150981196443079.png"/></p>

<h3 id="toc_21">方法名</h3>

<p>名字能体现出功能即可。不再累赘重述。</p>

<h2 id="toc_22">数据/接口定义</h2>

<h3 id="toc_23">建议</h3>

<ul>
<li>服务器返回数据采用json格式</li>
<li>json数据中无数据，必须返回空数组或空字符串，不可返回null</li>
<li>Android端使用gson或fastjson或jackson等三方解析工具解析</li>
<li>不建议使用官方JSONObject解析，容易出错</li>
<li>实体类属性名与json中字段名完全一致</li>
<li>json中字段名全部使用英文，不可英文、拼音夹杂</li>
<li>用户表识建议使用Cookie</li>
<li>建议使用POST解析，它对参数数量没有要求，也比较安全</li>
<li>为了传输安全，使用https请求 等</li>
<li>完善接口文档，建议每一版对应一个完整接口文档</li>
</ul>

<h2 id="toc_24">屏幕适配</h2>

<p>安卓设备分辨率、屏幕尺寸五花八门，碎片化严重，重点对市面上主流的720 * 1280和1080 * 1920手机进行适配，同时对于其他类型手机也要适配。</p>

<p>关于屏幕适配，之前写过一个Android屏幕完美适配方案，<a href="http://blog.csdn.net/jiashuai94/article/details/77639511">点击前往</a>，这里不再重复表述。</p>

<h2 id="toc_25">程序架构MVP</h2>

<p><img src="http://ohtrrgyyd.bkt.clouddn.com/20171105150981206687113.png" alt="20171105150981206687113.png"/></p>

<h3 id="toc_26">上图介绍：</h3>

<p><strong>Contract</strong>：契约类，一个功能模块中View接口、Model接口和请求数据回调统一在对应模块的Contract中定义，便于管理。</p>

<p><strong>ViewInterface</strong>： view层接口，定义了view中的UI操作</p>

<p><strong>ModelInterface</strong>： model层接口，定义了model负责的数据操作方法，如请求接口，操作数据库等</p>

<p><strong>CallbackInterface</strong>： model层操作数据完成后的回调</p>

<p><strong>BasePersenter</strong>： Persenter父类，主要是对相关view的获取，销毁等操作</p>

<p><strong>View</strong>： view层实现类，主要就是Activity或Fragment，负责UI展示和事件响应</p>

<p><strong>Model</strong>： model层实现类，就是依据业务，请求对应接口或数据库，并将结果返给回调CallBack</p>

<p><strong>Persenter</strong>： persenter层类，负责业务逻辑处理，view将响应传给persenter，persenter负责调用model，并将结果返回给view供其展示</p>

<h3 id="toc_27">MVP：</h3>

<p>MVP模式相当于在MVC模式中又加了一个Presenter用于处理模型和逻辑，将View和Model完全独立开，在android开发中的体现就是activity仅用于显示界面和交互，activity不参与模型结构和逻辑。</p>

<p>使用MVP模式会使得代码多出一些接口但是使得代码逻辑更加清晰，尤其是在处理复杂界面和逻辑时，我们可以对同一个activity将每一个业务都抽离成一个Presenter，这样代码既清晰逻辑明确又方便我们扩展。当然如果我们的业务逻辑本身就比较简单的话使用MVP模式就显得，没那么必要。所以我们不需要为了用它而用它，具体的还是要要业务需要</p>

<p>现在比较流行MVVM架构，后续我会将MVVM总结，大家期待一下。。</p>

<h2 id="toc_28">package划分</h2>

<p><img src="http://ohtrrgyyd.bkt.clouddn.com/20171105150981211916250.png" alt="20171105150981211916250.png"/></p>

<p>如上：主体按功能模块划分，同一级的还有一些技术点，如adapter、util、pay等；在功能模块下，按照mvp模式，又分为contract、model、presenter、fragment和activity；而在其他技术点包下面同样也按功能模块划分。</p>

<p>总之，我们划分包时：以功能模块为主，以技术点为辅。</p>

<h2 id="toc_29">Base、Util、UI类封装</h2>

<h3 id="toc_30">Base类</h3>

<ul>
<li>BaseApplication</li>
<li>BaseActivity</li>
<li>BaseFragment</li>
<li>BasePresenter 等</li>
</ul>

<h4 id="toc_31">BaseApplication：</h4>

<p>主要进行一些例如：<strong>三方配置</strong>、<strong>热更新加载</strong>、<strong>文件配置</strong>、<strong>数据库配置</strong>等准备工作；同时也许定义全局性变量：如<strong>Application的Context</strong>、<strong>网络状态</strong>、<strong>主线程Looper</strong>、<strong>主线程Handler</strong>等。</p>

<h4 id="toc_32">BaseActivity：</h4>

<p>封装为抽象类，将各任务抽取成方法，有子类实现：比如<strong>findViewById(initView)</strong>、<strong>initData</strong>、<strong>setListener</strong>等；</p>

<p>对友盟统计的封装：因为友盟统计或别的统计需要在所有Activity的各生命周期方法中调用api，所以应该将其封装到BaseActivity中。</p>

<p>项目为MVP结构，所以设置了View和Presenter的泛型，如：</p>

<p>其中定义了屏幕宽高度等设备信息，也定义了BasePresenter对象、并抽取抽象方法，由子类返回其对应presenter。</p>

<p><img src="http://ohtrrgyyd.bkt.clouddn.com/20171105150981225588056.png" alt="20171105150981225588056.png"/></p>

<h4 id="toc_33">BaseFragment：</h4>

<p>BaseFragment的封装如BaseActivity一样，添加View和Presenter的泛型和presenter对象，创建返回Presenter的抽象方法供子类事项；</p>

<p>创建createView(创建跟视图view)、initChildView(子view findViewById)、initData(加载数据)抽象方法</p>

<h4 id="toc_34">BasePresenter：</h4>

<p><img src="http://ohtrrgyyd.bkt.clouddn.com/20171105150981228211507.png" alt="20171105150981228211507.png"/></p>

<p>BasePresenter封装如上：内置view的软引用，在Activity或Fragment的onResume中调用presenter的attachView方法，将view实例传给presenter；在Activity或Fragment的onDestroy或onStop方法中调用detachView方法解除与view的绑定；而getView方法则是presenter在model返回数据后调用来操作对应view的展示UI方法。</p>

<h3 id="toc_35">Utils类</h3>

<h4 id="toc_36">只列举一些常用的工具类：</h4>

<ul>
<li>SharedPreferenceUtils</li>
<li>ToastUtils</li>
<li>StorageUtils</li>
<li>FileUtils</li>
<li>NetUtils</li>
<li>deviceUtils</li>
<li>DateUtils</li>
<li>LogUtils</li>
<li>AppUtils 等</li>
</ul>

<h3 id="toc_37">UI类</h3>

<h4 id="toc_38">只列举一些常用的View类</h4>

<ul>
<li>下拉刷新、上拉加载</li>
<li>圆形ImageView</li>
<li>自定义Dialog</li>
<li>Banner</li>
<li>自定义ScrollView</li>
<li>自定义RecyclerView</li>
<li>项目相关的自定义View 等</li>
</ul>

<h2 id="toc_39">数据库</h2>

<p>关于数据库操作，之前一直是自己写：也就是SQLiteOpenHelper结合相关SQL操作工具类来实现数据库操作。</p>

<p>但随着业务逻辑的增加和复杂，需要进行大量的数据库操作时，编写大量的代码，既费时间、还会避免不了地出bug；</p>

<p>所以我们只介绍几款流行的数据库框架：</p>

<ul>
<li>GreenDao</li>
<li>OrmLite</li>
<li>LitePal</li>
<li>Realm</li>
</ul>

<h3 id="toc_40">GreenDao：</h3>

<p><strong>特点</strong>：</p>

<ol>
<li>存取速度快; </li>
<li>支持数据库加密; </li>
<li>轻量级; </li>
<li>激活实体;</li>
<li>支持缓存; </li>
<li>代码自动生成</li>
</ol>

<p><strong>地址</strong>：<a href="https://github.com/greenrobot/greenDAO">https://github.com/greenrobot/greenDAO</a></p>

<h3 id="toc_41">OrmLite：</h3>

<p><strong>优点</strong>： </p>

<ol>
<li>轻量级；</li>
<li>使用简单，易上手；</li>
<li>封装完善；</li>
<li>文档全面。</li>
</ol>

<p><strong>缺点</strong>：</p>

<ol>
<li>基于反射，效率较低（本人还没有觉得效率低)</li>
<li>缺少中文翻译文档</li>
</ol>

<p><strong>jar包地址</strong>：<a href="http://ormlite.com/releases/">http://ormlite.com/releases/</a></p>

<h3 id="toc_42">LitePal：</h3>

<p>LitePal 框架是郭大神开源的数据库框架，他的博客也比较详细的介绍了其用法。</p>

<p>地址：<a href="https://github.com/LitePalFramework/LitePal">https://github.com/LitePalFramework/LitePal</a></p>

<h3 id="toc_43">Realm：</h3>

<ol>
<li><p>易用：Ream 不是在SQLite基础上的ORM，它有自己的数据查询引擎。并且十分容易使用。</p></li>
<li><p>快速：由于它是完全重新开始开发的数据库实现，所以它比任何的ORM速度都快很多，甚至比SLite速度都要快。</p></li>
<li><p>跨平台：Realm 支持 iOS &amp; OS X (Objective‑C &amp; Swift) &amp; Android。我们可以在这些平台上共享Realm数据库文件，并且上层逻辑可以不用任何改动的情况下实现移植。</p></li>
<li><p>高级：Ream支持加密，格式化查询，易于移植，支持JSON，流式api，数据变更通知等高级特性</p></li>
<li><p>可视化</p></li>
</ol>

<p><a href="https://github.com/realm/realm-java">git地址</a></p>

<p><a href="https://realm.io/docs/java/latest/#getting-started">官网</a></p>

<p>自己项目中使用了GreenDao，它代码自动生成、存取速度快、支持加密、一个轻量级别的库，用着方便，推荐大家使用GreenDao。</p>

<h2 id="toc_44">图片处理</h2>

<p>之前有自己封装过图片处理框架，核心是使用HttpUrlConnection实现加载，仿LruCache（近期最少使用排序）算法实现图片缓存。</p>

<p>但我们用的最多的还是ImageLoader、Glide、Picasso和Fresco四大主流框架，接下来主要比较一下四个框架的各自特点：</p>

<h3 id="toc_45">ImageLoader：</h3>

<p><strong>优点</strong>:</p>

<ul>
<li>多线程下载，线程管理。</li>
<li>多级缓存架构设计和策略，内存缓存，磁盘缓存，缓存有效性处理。</li>
<li>图片压缩，特效处理，动画处理。</li>
<li>复杂网络情况下下载图片策略，例如弱网络等。</li>
<li>内存管理，lru 算法、对象引用、GC回收等优化。</li>
</ul>

<p><strong>缺点</strong>：</p>

<ul>
<li>时间久，官方不再维护，出现bug需要自己修复。</li>
</ul>

<h3 id="toc_46">Glide：</h3>

<p><strong>优点</strong>：</p>

<ul>
<li>更易用，因为Glide的with方法不光接受Context，还接受Activity 和 Fragment，Context会自动的从他们获取。同时将Activity/Fragment作为with()参数的好处是：图片加载会和Activity/Fragment的生命周期保持一致，比如Paused状态在暂停加载，在Resumed的时候又自动重新加载。所以我建议传参的时候传递Activity 和 Fragment给Glide，而不是Context。</li>
<li>Glide可以加载GIF动态图。</li>
<li>Glide缓存的是跟ImageView尺寸相同的。Glide的这种方式优点是加载显示非常快。</li>
<li>默认使用HttpUrlConnection下载图片，可以配置为OkHttp或者Volley下载，也可以自定义下载方式。</li>
<li>默认使用手机内置存储进行磁盘缓存，可以配置为外部存储，可以配置缓存大小，图片池大小。</li>
<li>默认使用两个线程池来分别执行读取缓存和下载任务，都可以自定义。</li>
</ul>

<p><strong>缺点</strong>：</p>

<ul>
<li>Glide加载的图片质量要差于Picasso，这是因为Glide默认的Bitmap格式是RGB_565，比ARGB_8888格式的内存开销要小一半。</li>
</ul>

<h3 id="toc_47">Picasso：</h3>

<p><strong>特点</strong>：</p>

<ul>
<li>在adapter中需要取消已经不在视野范围的ImageView图片资源的加载，否则会导致图片错位，Picasso已经解决了这个问题。</li>
<li>使用复杂的图片压缩转换来尽可能的减少内存消耗</li>
<li>自带内存和硬盘二级缓存功能</li>
</ul>

<h3 id="toc_48">Fresco：</h3>

<p><strong>优点</strong>：</p>

<ul>
<li>最大的优势便在于5.0以下(最低2.3) bitmap的加载，在5.0以下系统，Fresco将图片放到一个特别的内存区域(Ashmem)，而且图片不显示时，占用的内存会自动被释放，这会使APP更加流畅，减少因图片内存占用而引发的OOM。5.0以后的系统默认存储在Ashmem区了</li>
<li>图片的渐进式呈现，图片先呈现大致的轮廓，然后随着图片下载的继续，逐渐成仙清晰的图片，这对于慢网络对说，用户体验更好。</li>
<li>支持加载Git动态图和Webp格式的图片。</li>
</ul>

<p><strong>缺点</strong>：</p>

<ul>
<li>框架体积比较大，3M左右，会增加APK的大小。</li>
</ul>

<p>总结：在项目开发中，要适当的选择图片框架，ImageLoader太老已过时，且官方不再维护，所以不再考虑使用ImageLoader；Picasso能做的，Glide都能做到，就是Glide的图片质量会稍差一些；而Fresco又体积偏大，但渐进式呈现，用户体验好。综上的话，一般项目建议使用Glide即可。</p>

<h2 id="toc_49">网络框架</h2>

<p>上一个项目中，网络框架自己封装：核心使用HttpUrlConnection实现，先封装请求参数相关类RequestVo，其中包含请求方式、url、参数、解析类、是否缓存、缓存时长等参数；缓存是将json字符串加密后与拼接过的url成对存储到File，并且设置有效时间，超过有效时间删除缓存并去网络请求，成功后重新保存。</p>

<p>但现在市面上最流行的是Retrofit+RxJava+Gson，接下来我们大概介绍一下：</p>

<h3 id="toc_50">添加依赖</h3>

<pre><code class="language-text">compile &#39;io.reactivex:rxjava:x.y.z&#39;
compile &#39;io.reactivex:rxandroid:1.0.1&#39;
compile &#39;com.squareup.retrofit2:retrofit:2.0.2&#39;
compile &#39;com.squareup.retrofit2:converter-gson:2.0.2&#39;
compile &#39;com.squareup.retrofit2:adapter-rxjava:2.0.2&#39;
</code></pre>

<p>要注意：以上添加了Retrofit、RxJava和Gson依赖，版本号必须一致</p>

<h3 id="toc_51">登录Service</h3>

<pre><code class="language-text">interface BaseService {
  @GET(&quot;user/login&quot; )
  Observable&lt;User&gt; login(
          @Query(&quot;username&quot;) String username,
          @Query(&quot;password&quot;) String password
  );
}
</code></pre>

<p>login方法的返回值是Observable类型，就是RxJava中的被观察者。</p>

<h3 id="toc_52">网络请求</h3>

<pre><code class="language-java">Retrofit retrofit = new Retrofit.Builder()
    .addConverterFactory(GsonConverterFactory.create()           
    .addCallAdapterFactory(RxJavaCallAdapterFactory.create())//新的配置
    .baseUrl(BASE_URL)
    .build();
BaseService service = retrofit.create(BaseService.class);

service.login(phone, password)               //获取Observable对象
    .subscribeOn(Schedulers.newThread())//请求在新的线程中执行
    .observeOn(Schedulers.io())         //请求完成后在io线程中执行
    .doOnNext(new Action1&lt;UserInfo&gt;() {
        @Override
        public void call(User user) {
            saveUserInfo(user);//保存用户信息到本地
        }
    })
    .observeOn(AndroidSchedulers.mainThread())//最后在主线程中执行
    .subscribe(new Subscriber&lt;User&gt;() {
        @Override
        public void onCompleted() {

        }

        @Override
        public void onError(Throwable e) {
            //请求失败
        }

        @Override
        public void onNext(User user) {
            //请求成功
        }
});
</code></pre>

<p>RxJava + Retrofit 形式的时候，Retrofit 把请求封装进 Observable ，在请求结束后调用 onNext() 或在请求失败后调用 onError()。</p>

<p>可以看到，调用了service的login方法后得到Observable对象，在新的线程中执行网络请求，请求成功后切换到io线程执行保存用户信息的动作，最后再切换到主线程执行请求失败onError()、请求成功onNext()。整体的逻辑十分清晰都在一条链中，就算还有别的要求还可以往里面添加，丝毫不影响代码的简洁。</p>

<pre><code class="language-text">注意：Retrofit在创建的时候添了一下代码
addCallAdapterFactory(RxJavaCallAdapterFactory.create())
</code></pre>

<p>想了解更多关于RxJava，浏览<a href="http://gank.io/post/560e15be2dca930e00da1083#toc_1">http://gank.io/post/560e15be2dca930e00da1083#toc_1</a></p>

<h2 id="toc_53">其他三方</h2>

<p>在自己的开发过程中，还用到了如EventBus、Zxing、Zbar、Volley、Gson、LeakCanary等三方框架；</p>

<p>也用到了如友盟统计、微信、支付宝支付、三方登录、极光推送、tinker热更新等三方sdk；</p>

<p>就不再一一列举，附上一张图，大家有时间多去学习、多去了解。</p>

<p><img src="http://ohtrrgyyd.bkt.clouddn.com/20171105150981301966614.png" alt="20171105150981301966614.png"/></p>

<h2 id="toc_54">混淆、加固、上线</h2>

<h3 id="toc_55">混淆</h3>

<p>大家可以参考我的<a href="http://blog.csdn.net/jiashuai94/article/details/77991077">另一篇文章</a></p>

<p>混淆是上线前挺重要的一个环节。Android使用的ProGuard，可以起到压缩，混淆，预检，优化的作用。</p>

<h4 id="toc_56">坚持以下几项原则：</h4>

<ul>
<li>使用三方依赖，在混淆文件中添加官方提供的混淆代码，官方没有就google；</li>
<li>实体类不混淆，因为实体类涉及到与服务端的交互，各种gson的交互如此等等，是要保留的；</li>
<li>与js互调的类不混淆；</li>
<li>与反射有关的类不混淆 等。</li>
</ul>

<h4 id="toc_57">具体语法：</h4>

<pre><code class="language-text">-optimizationpasses 5 // 代码混淆的压缩比例，值在0-7之间
-dontusemixedcaseclassnames // 混淆后类名都为小写
-dontskipnonpubliclibraryclasses // 指定不去忽略非公共的库的类
-dontskipnonpubliclibraryclassmembers // 指定不去忽略非公共的库的类的成员
-dontpreverify // 不做预校验的操作

-verbose
-printmapping proguardMapping.txt // 生成原类名和混淆后的类名的映射文件

-optimizations !code/simplification/cast,!field/*,!class/merging/* // 指定混淆时采用的算法
-keepattributes *Annotation*,InnerClasses // 不混淆Annotation
-keepattributes Signature // 不混淆泛型
-keepattributes SourceFile,LineNumberTable // 抛出异常时保留代码行号
-keep class XXXX // 保留类名不变，也就是类名不混淆，而类中的成员名不保证。当然也可以是继承XXX类的所有类名不混淆，具体代码不贴了，重在理解。
-keepclasseswithmembers class XXXX // 保留类名和成员名。当然也可以是类中特定方法，代码不贴了，理由同上。
</code></pre>

<p><strong>加固</strong>：</p>

<p>加固一般都使用三方加固：如果apk上百度应用市场，则使用百度加固，其他情况建议使用360加固，当然，加固前一定是混淆过的、并且签过名的apk。</p>

<p>360加固还提供了一些其他服务，可根据项目情况操作（是需要花钱的..）</p>

<p><strong>上线</strong>：</p>

<p>也就是我们所说的发版，当你的apk测试通过，混淆过、签名过、也加固了，可以发版了。</p>

<p>每个公司上线的市场要求不同，一般主要有应用宝、360、豌豆荚、百度市场、小米市场、华为市场、魅族市场等，当然还有官网了。</p>

<p>发版时需要：apk当然要有、logo（第一次上线）、应用简介（第一次上线）、版本号、更新功能、介绍图、官网地址（第一次上线）等。</p>

<p>ok，到这里，我们的一个阶段算是完成了，接下来还会有更多的业务和bug等着大家，哈哈！希望这篇文章能对大家有一点点帮助。</p>


    

      </div>

      <div class="row">
        <div class="large-6 columns">
        <p class="text-left" style="padding:15px 0px;">
      
          <a href="15561207871029.html" 
          title="Previous Post: Android Launcher启动Activity的工作过程">&laquo; Android Launcher启动Activity的工作过程</a>
      
        </p>
        </div>
        <div class="large-6 columns">
      <p class="text-right" style="padding:15px 0px;">
      
          <a  href="15561207870990.html" 
          title="Next Post: Android机型适配">Android机型适配 &raquo;</a>
      
      </p>
        </div>
      </div>
      <div class="comments-wrap">
        <div class="share-comments">
          

          

          
        </div>
      </div>
    </div><!-- article-wrap -->
  </div><!-- large 8 -->




 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <h1>MagicalRice的Blog</h1>
                <div class="site-des">技术博客</div>
                <div class="social">











  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="Android.html"><strong>Android</strong></a>
        
            <a href="%E9%9A%8F%E6%89%8B%E8%AE%B0.html"><strong>随手记</strong></a>
        
            <a href="%E6%9C%8D%E5%8A%A1%E5%99%A8.html"><strong>服务器</strong></a>
        
            <a href="C++.html"><strong>C++</strong></a>
        
            <a href="UI.html"><strong>UI</strong></a>
        
            <a href="MySQL.html"><strong>MySQL</strong></a>
        
            <a href="%E7%AE%97%E6%B3%95.html"><strong>算法</strong></a>
        
            <a href="Game.html"><strong>Game</strong></a>
        
            <a href="Python.html"><strong>Python</strong></a>
        
            <a href="%E8%B7%A8%E5%B9%B3%E5%8F%B0%E5%BC%80%E5%8F%91.html"><strong>跨平台开发</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15663678647312.html">Docker学习</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15662718181666.html">Android GRPC接入</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15662693410122.html">Docker搭建Maven私服</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15639522586909.html">Kotlin为序列化类生成serialVersionUID</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15620327900428.html">Xposed开发</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>


  </body>
</html>
